import{_ as o,c as a,o as c,ae as d}from"./chunks/framework.Cqi9LMMK.js";const h=JSON.parse('{"title":"Block new apps","description":"","frontmatter":{},"headers":[],"relativePath":"android-app/installation/block-new-apps.md","filePath":"android-app/installation/block-new-apps.md"}'),l={name:"android-app/installation/block-new-apps.md"};function i(p,e,r,t,s,n){return c(),a("div",null,[...e[0]||(e[0]=[d('<h1 id="block-new-apps" tabindex="-1">Block new apps <a class="header-anchor" href="#block-new-apps" aria-label="Permalink to &quot;Block new apps&quot;">​</a></h1><h2 id="where-it-lives" tabindex="-1">Where it lives <a class="header-anchor" href="#where-it-lives" aria-label="Permalink to &quot;Where it lives&quot;">​</a></h2><ul><li><code>app/src/main/java/com/tripleu/ui/fragments/PrivacyFragment.kt</code></li><li><code>app/src/main/java/com/tripleu/appcontrol/AppInstallReceiver.kt</code></li><li><code>app/src/main/java/com/tripleu/appcontrol/NewAppDetector.kt</code></li><li><code>app/src/main/java/com/tripleu/appcontrol/NewAppDetectorWorker.kt</code></li><li><code>app/src/main/java/com/tripleu/appcontrol/AppMonitorService.kt</code></li><li><code>app/src/main/java/com/tripleu/appcontrol/AppMonitorUtils.kt</code></li><li><code>app/src/main/java/com/tripleu/ui/fragments/UpdateAppsFragment.kt</code></li><li><code>app/src/main/java/com/tripleu/config/ConfigPoller.kt</code></li><li><code>app/src/main/java/com/tripleu/vpn/AdVpnService.java</code></li><li><code>app/src/main/java/com/tripleu/vpn/AdVpnServiceKt.kt</code></li></ul><h2 id="what-it-does" tabindex="-1">What it does <a class="header-anchor" href="#what-it-does" aria-label="Permalink to &quot;What it does&quot;">​</a></h2><ul><li>When enabled, newly installed apps are hidden + suspended unless approved.</li><li>Update installs are ignored (<code>Intent.EXTRA_REPLACING</code>).</li><li>Detected apps are mirrored into local snapshot + Firestore for review.</li></ul><h2 id="how-it-works" tabindex="-1">How it works <a class="header-anchor" href="#how-it-works" aria-label="Permalink to &quot;How it works&quot;">​</a></h2><ul><li>Toggle calls <code>handleBlockNewAppsToggle</code> and sets <code>block_new_apps</code> (prefs) + <code>apps.block_new_apps</code> (<code>ConfigStore</code>).</li><li>On enable: <ul><li>Seeds <code>known_installed_packages</code> (current launchable apps).</li><li>Starts <code>AppMonitorService</code> (foreground; checks every ~20s).</li><li>Schedules <code>NewAppDetector</code> (WorkManager; every 15 minutes).</li></ul></li><li>Detection paths: <ul><li><code>AppInstallReceiver</code> catches <code>ACTION_PACKAGE_ADDED</code> and blocks any new package not in approvals.</li><li><code>AppMonitorService</code> calls <code>AppMonitorUtils.monitorOnce()</code> to compare <code>known_installed_packages</code> vs current launchable apps.</li><li><code>NewAppDetectorWorker</code> scans for new launchable apps and checks Firestore approval before blocking.</li><li><code>AdVpnService.monitorUserAppsOnce()</code> also runs when VPN is active.</li></ul></li><li>When a new unapproved app is found: <ul><li><code>PolicyManager.toggleAppBlock(..., true)</code> + <code>PolicyManager.setAppSuspended(..., true)</code>.</li><li>Writes a pending app record to <code>AppSnapshotStorage</code> and Firestore.</li><li>Receiver/worker paths trigger <code>CloudSyncManager.manualSync()</code>.</li></ul></li></ul><h2 id="how-approval-works" tabindex="-1">How approval works <a class="header-anchor" href="#how-approval-works" aria-label="Permalink to &quot;How approval works&quot;">​</a></h2><ul><li>Local approvals: <code>approved_apps</code> (prefs).</li><li>Cloud approvals: <code>apps.approved</code> from <code>ConfigStore</code>, plus Firestore <code>devices/{deviceId}/apps/{package}</code> where <code>approved=true</code> or <code>hidden=false</code> + <code>suspended=false</code>.</li><li><code>UpdateAppsFragment</code> marks apps approved when you Unhide, Unsuspend, or Enable.</li><li><code>AppInstallReceiver</code> removes packages from <code>approved_apps</code> on uninstall.</li><li>Approved apps are unblocked on each monitor pass.</li><li>Portal-enforced hides/suspends are respected via: <ul><li><code>MDMSettings.policy_hidden_apps</code></li><li><code>MDMSettings.policy_suspended_apps</code></li></ul></li></ul><h2 id="firestore-snapshot-fields-written" tabindex="-1">Firestore/snapshot fields written <a class="header-anchor" href="#firestore-snapshot-fields-written" aria-label="Permalink to &quot;Firestore/snapshot fields written&quot;">​</a></h2><ul><li><code>deviceId</code>, <code>label</code>, <code>system</code>, <code>versionName</code>, <code>versionCode</code>.</li><li><code>hidden</code>, <code>suspended</code>, <code>uninstallBlocked</code>, <code>networkBlocked</code>, <code>webviewBlocked</code>, <code>webviewException</code>, <code>videoBlocked</code>, <code>approved</code>.</li><li><code>detectedAtMs</code>, <code>updatedAtMs</code>, <code>source</code>, <code>installed</code>, <code>managed</code>. Note: <code>system</code> means &quot;not launchable&quot; (based on <code>getLaunchIntentForPackage</code>).</li></ul><h2 id="state-stored" tabindex="-1">State stored <a class="header-anchor" href="#state-stored" aria-label="Permalink to &quot;State stored&quot;">​</a></h2><ul><li>Prefs: <code>block_new_apps</code>, <code>approved_apps</code>, <code>known_installed_packages</code>.</li><li><code>ConfigStore</code>: <code>apps.block_new_apps</code>, <code>apps.approved</code>, <code>apps.known_installed</code>.</li><li>Firestore: <code>devices/{deviceId}/apps/{package}</code>.</li></ul>',13)])])}const k=o(l,[["render",i]]);export{h as __pageData,k as default};
