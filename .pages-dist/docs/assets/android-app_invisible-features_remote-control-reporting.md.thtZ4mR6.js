import{_ as o,c as t,o as i,ae as a}from"./chunks/framework.Cqi9LMMK.js";const u=JSON.parse('{"title":"Remote control + reporting","description":"","frontmatter":{},"headers":[],"relativePath":"android-app/invisible-features/remote-control-reporting.md","filePath":"android-app/invisible-features/remote-control-reporting.md"}'),r={name:"android-app/invisible-features/remote-control-reporting.md"};function c(l,e,d,s,n,h){return i(),t("div",null,[...e[0]||(e[0]=[a('<h1 id="remote-control-reporting" tabindex="-1">Remote control + reporting <a class="header-anchor" href="#remote-control-reporting" aria-label="Permalink to &quot;Remote control + reporting&quot;">​</a></h1><h2 id="remote-command-receiver" tabindex="-1">Remote command receiver <a class="header-anchor" href="#remote-command-receiver" aria-label="Permalink to &quot;Remote command receiver&quot;">​</a></h2><h3 id="where-it-lives" tabindex="-1">Where it lives <a class="header-anchor" href="#where-it-lives" aria-label="Permalink to &quot;Where it lives&quot;">​</a></h3><ul><li><code>app/src/main/java/com/tripleu/commands/CommandReceiver.kt</code></li><li><code>app/src/main/java/com/tripleu/config/FirestoreDevicePaths.kt</code></li></ul><h3 id="what-it-does" tabindex="-1">What it does <a class="header-anchor" href="#what-it-does" aria-label="Permalink to &quot;What it does&quot;">​</a></h3><ul><li>Listens for admin commands in Firestore and executes them.</li><li>Updates command status and writes a small audit record.</li></ul><h3 id="how-it-runs" tabindex="-1">How it runs <a class="header-anchor" href="#how-it-runs" aria-label="Permalink to &quot;How it runs&quot;">​</a></h3><ul><li>Watches: <code>devices/{deviceId}/commands</code>.</li><li>Supported command types: <ul><li><code>lock</code>: <code>PolicyManager.lockDevice()</code>.</li><li><code>wipe</code>: <code>PolicyManager.wipeDevice()</code>.</li><li><code>sync</code>: <code>ConfigPoller.start()</code>.</li><li><code>uninstall</code>: reverts policies + clears device owner.</li><li><code>inventory</code>: <code>AppInventoryUploader.uploadNow()</code>.</li><li><code>start_remote</code>: clears previous session data, sets <code>remote_session.status=starting</code>, launches <code>RemotePermissionActivity</code>.</li><li><code>stop_remote</code>: stops <code>RemoteService</code> and marks session ended.</li></ul></li><li>Status flow: <code>pending</code> -&gt; <code>done</code> or <code>error</code>.</li><li>If the command collection is missing, it tries to adopt <code>users/{uid}.activeDeviceId</code>.</li></ul><h2 id="remote-support-screen-share-control" tabindex="-1">Remote support (screen share + control) <a class="header-anchor" href="#remote-support-screen-share-control" aria-label="Permalink to &quot;Remote support (screen share + control)&quot;">​</a></h2><h3 id="where-it-lives-1" tabindex="-1">Where it lives <a class="header-anchor" href="#where-it-lives-1" aria-label="Permalink to &quot;Where it lives&quot;">​</a></h3><ul><li><code>app/src/main/java/com/tripleu/remote/RemotePermissionActivity.kt</code></li><li><code>app/src/main/java/com/tripleu/remote/RemoteService.kt</code></li><li><code>app/src/main/java/com/tripleu/remote/RemoteStreamManager.kt</code></li><li><code>app/src/main/java/com/tripleu/remote/RemoteInputHandler.kt</code></li><li><code>app/src/main/java/com/tripleu/remote/RemoteInputReceiver.kt</code></li></ul><h3 id="what-it-does-1" tabindex="-1">What it does <a class="header-anchor" href="#what-it-does-1" aria-label="Permalink to &quot;What it does&quot;">​</a></h3><ul><li>Shares the device screen to an admin.</li><li>Accepts remote input (tap, swipe, text, nav keys) via accessibility.</li><li>Tracks session status in Firestore.</li></ul><h3 id="how-it-runs-1" tabindex="-1">How it runs <a class="header-anchor" href="#how-it-runs-1" aria-label="Permalink to &quot;How it runs&quot;">​</a></h3><ul><li><code>RemotePermissionActivity</code> requests MediaProjection and starts <code>RemoteService</code>.</li><li><code>RemoteService</code> runs foreground and creates <code>RemoteStreamManager</code>.</li><li><code>RemoteStreamManager</code>: <ul><li>Uses WebRTC for video.</li><li>Uses Firestore for signaling: <code>devices/{deviceId}/remote_session/current</code>.</li><li>ICE candidates in subcollections <code>ice_candidates</code> and <code>remote_candidates</code>.</li><li>DataChannel <code>control</code> receives JSON input events.</li></ul></li><li><code>RemoteInputHandler</code> injects gestures and text through <code>AppBlockAccessibilityService</code>: <ul><li><code>input</code> (tap/drag), <code>nav</code> (home/back/recents), <code>text</code>, <code>key</code> (backspace/enter).</li><li>If accessibility is not running, it broadcasts to <code>RemoteInputReceiver</code>.</li></ul></li><li>Session status is updated to <code>starting</code>, <code>offering</code>, <code>connected</code>, or <code>ended</code>.</li></ul><h2 id="report-portal-share" tabindex="-1">Report portal share <a class="header-anchor" href="#report-portal-share" aria-label="Permalink to &quot;Report portal share&quot;">​</a></h2><h3 id="where-it-lives-2" tabindex="-1">Where it lives <a class="header-anchor" href="#where-it-lives-2" aria-label="Permalink to &quot;Where it lives&quot;">​</a></h3><ul><li><code>app/src/main/java/com/tripleu/ui/activities/ReportShareActivity.kt</code></li><li><code>app/src/main/java/com/tripleu/ui/activities/ReportPortalActivity.kt</code></li><li><code>app/src/main/AndroidManifest.xml</code></li></ul><h3 id="what-it-does-2" tabindex="-1">What it does <a class="header-anchor" href="#what-it-does-2" aria-label="Permalink to &quot;What it does&quot;">​</a></h3><ul><li>Adds a Share target for URLs to open a local report portal.</li></ul><h3 id="how-it-runs-2" tabindex="-1">How it runs <a class="header-anchor" href="#how-it-runs-2" aria-label="Permalink to &quot;How it runs&quot;">​</a></h3><ul><li><code>ReportShareActivity</code> is exported for <code>ACTION_SEND</code> with <code>text/plain</code>.</li><li>It extracts a URL from shared text and builds: <ul><li><code>http://10.9.0.1/.kvylock/appeal?mode=report&amp;url=...&amp;host=...</code></li></ul></li><li>Launches <code>ReportPortalActivity</code> with that URL.</li><li><code>ReportPortalActivity</code> loads the portal URL in a WebView.</li></ul>',22)])])}const p=o(r,[["render",c]]);export{u as __pageData,p as default};
