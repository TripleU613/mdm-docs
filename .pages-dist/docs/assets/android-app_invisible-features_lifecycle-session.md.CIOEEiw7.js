import{_ as i,c as o,o as a,ae as t}from"./chunks/framework.Cqi9LMMK.js";const p=JSON.parse('{"title":"Lifecycle + session","description":"","frontmatter":{},"headers":[],"relativePath":"android-app/invisible-features/lifecycle-session.md","filePath":"android-app/invisible-features/lifecycle-session.md"}'),l={name:"android-app/invisible-features/lifecycle-session.md"};function s(r,e,c,d,n,h){return a(),o("div",null,[...e[0]||(e[0]=[t('<h1 id="lifecycle-session" tabindex="-1">Lifecycle + session <a class="header-anchor" href="#lifecycle-session" aria-label="Permalink to &quot;Lifecycle + session&quot;">​</a></h1><h2 id="app-startup-bootstrap" tabindex="-1">App startup bootstrap <a class="header-anchor" href="#app-startup-bootstrap" aria-label="Permalink to &quot;App startup bootstrap&quot;">​</a></h2><h3 id="where-it-lives" tabindex="-1">Where it lives <a class="header-anchor" href="#where-it-lives" aria-label="Permalink to &quot;Where it lives&quot;">​</a></h3><ul><li><code>app/src/main/java/com/tripleu/TripleUApp.kt</code></li></ul><h3 id="what-it-does" tabindex="-1">What it does <a class="header-anchor" href="#what-it-does" aria-label="Permalink to &quot;What it does&quot;">​</a></h3><ul><li>Boots background services and watchers after first resume (or 10s fallback).</li><li>Runs only in the main app process.</li><li>Reapplies app density.</li></ul><h3 id="how-it-runs" tabindex="-1">How it runs <a class="header-anchor" href="#how-it-runs" aria-label="Permalink to &quot;How it runs&quot;">​</a></h3><ul><li><code>triggerDeferredStartup()</code> waits ~350ms after first resume.</li><li><code>startDeferredWork()</code> starts: <ul><li><code>AccessibilityMonitorService</code> (foreground).</li><li><code>AutoUpdateManager</code> schedule + immediate check.</li><li><code>HomeUpdateBridge</code>, <code>ConfigPoller</code>, <code>CloudSyncManager</code>.</li><li><code>CommandReceiver</code>, <code>AppRemoteWatcher</code>, <code>Vpn2RemoteWatcher</code>.</li><li><code>AppInventoryUploader</code> and <code>NewAppDetector</code>.</li><li><code>PeriodicTaskRunner</code> for shared 5s/30s/60s ticks.</li></ul></li><li>Registers <code>SessionLifecycleCallbacks</code> to lock the app on background.</li></ul><h2 id="boot-behavior" tabindex="-1">Boot behavior <a class="header-anchor" href="#boot-behavior" aria-label="Permalink to &quot;Boot behavior&quot;">​</a></h2><h3 id="where-it-lives-1" tabindex="-1">Where it lives <a class="header-anchor" href="#where-it-lives-1" aria-label="Permalink to &quot;Where it lives&quot;">​</a></h3><ul><li><code>app/src/main/java/com/tripleu/vpn/BootComplete.java</code></li></ul><h3 id="what-it-does-1" tabindex="-1">What it does <a class="header-anchor" href="#what-it-does-1" aria-label="Permalink to &quot;What it does&quot;">​</a></h3><ul><li>Restarts key services after device boot.</li></ul><h3 id="how-it-runs-1" tabindex="-1">How it runs <a class="header-anchor" href="#how-it-runs-1" aria-label="Permalink to &quot;How it runs&quot;">​</a></h3><ul><li>Calls <code>AdVpnService.checkStartVpnOnBoot(...)</code>.</li><li>Starts <code>Vpn2RemoteWatcher</code> and <code>PeriodicTaskRunner</code>.</li><li>Starts <code>AccessibilityMonitorService</code> as a foreground service.</li><li>If <code>block_new_apps</code> is enabled: <ul><li>Seeds known apps.</li><li>Starts <code>AppMonitorService</code>.</li></ul></li><li>Otherwise cancels <code>NewAppDetector</code> and stops <code>AppMonitorService</code>.</li></ul><h2 id="session-lock" tabindex="-1">Session lock <a class="header-anchor" href="#session-lock" aria-label="Permalink to &quot;Session lock&quot;">​</a></h2><h3 id="where-it-lives-2" tabindex="-1">Where it lives <a class="header-anchor" href="#where-it-lives-2" aria-label="Permalink to &quot;Where it lives&quot;">​</a></h3><ul><li><code>app/src/main/java/com/tripleu/session/Session.kt</code></li><li><code>app/src/main/java/com/tripleu/TripleUApp.kt</code></li></ul><h3 id="what-it-does-2" tabindex="-1">What it does <a class="header-anchor" href="#what-it-does-2" aria-label="Permalink to &quot;What it does&quot;">​</a></h3><ul><li>Locks the app when it leaves the foreground.</li><li>Allows short background grace periods for system pickers.</li></ul><h3 id="how-it-runs-2" tabindex="-1">How it runs <a class="header-anchor" href="#how-it-runs-2" aria-label="Permalink to &quot;How it runs&quot;">​</a></h3><ul><li><code>Session.activityResumed()</code> and <code>activityPaused()</code> track foreground state.</li><li><code>AUTH_TIMEOUT_MS</code> is 0, so auth resets immediately when the app backgrounds.</li><li><code>allowBackgroundFor()</code> delays lock for ~10s (file pickers, VPN consent).</li><li><code>TripleUApp.SessionLifecycleCallbacks</code> skips auth tracking for login/setup screens.</li></ul><h2 id="lockout-mode" tabindex="-1">Lockout mode <a class="header-anchor" href="#lockout-mode" aria-label="Permalink to &quot;Lockout mode&quot;">​</a></h2><h3 id="where-it-lives-3" tabindex="-1">Where it lives <a class="header-anchor" href="#where-it-lives-3" aria-label="Permalink to &quot;Where it lives&quot;">​</a></h3><ul><li><code>app/src/main/java/com/tripleu/config/ConfigPoller.kt</code></li><li><code>app/src/main/java/com/tripleu/ui/activities/LockoutActivity.kt</code></li></ul><h3 id="what-it-does-3" tabindex="-1">What it does <a class="header-anchor" href="#what-it-does-3" aria-label="Permalink to &quot;What it does&quot;">​</a></h3><ul><li>Forces the device into a locked kiosk screen from a remote config flag.</li><li>Prevents back navigation and keeps LockTask active.</li></ul><h3 id="how-it-runs-3" tabindex="-1">How it runs <a class="header-anchor" href="#how-it-runs-3" aria-label="Permalink to &quot;How it runs&quot;">​</a></h3><ul><li><code>ConfigPoller</code> checks <code>system.lockout_enabled</code>.</li><li>When true: <ul><li>Calls <code>setLockTaskPackages(...)</code> for this app.</li><li>Launches <code>LockoutActivity</code> with <code>NEW_TASK | REORDER_TO_FRONT</code>.</li></ul></li><li><code>LockoutActivity</code> calls <code>startLockTask()</code> and polls config every 3s.</li><li>When the flag turns off, it exits LockTask and finishes.</li></ul>',29)])])}const k=i(l,[["render",s]]);export{p as __pageData,k as default};
