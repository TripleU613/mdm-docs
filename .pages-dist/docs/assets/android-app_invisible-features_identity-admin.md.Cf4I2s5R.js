import{_ as i,c as a,o,ae as t}from"./chunks/framework.Cqi9LMMK.js";const p=JSON.parse('{"title":"Identity + admin","description":"","frontmatter":{},"headers":[],"relativePath":"android-app/invisible-features/identity-admin.md","filePath":"android-app/invisible-features/identity-admin.md"}'),l={name:"android-app/invisible-features/identity-admin.md"};function r(d,e,c,s,n,h){return o(),a("div",null,[...e[0]||(e[0]=[t('<h1 id="identity-admin" tabindex="-1">Identity + admin <a class="header-anchor" href="#identity-admin" aria-label="Permalink to &quot;Identity + admin&quot;">​</a></h1><h2 id="device-identity-firestore-paths" tabindex="-1">Device identity + Firestore paths <a class="header-anchor" href="#device-identity-firestore-paths" aria-label="Permalink to &quot;Device identity + Firestore paths&quot;">​</a></h2><h3 id="where-it-lives" tabindex="-1">Where it lives <a class="header-anchor" href="#where-it-lives" aria-label="Permalink to &quot;Where it lives&quot;">​</a></h3><ul><li><code>app/src/main/java/com/tripleu/config/FirestoreDevicePaths.kt</code></li></ul><h3 id="what-it-does" tabindex="-1">What it does <a class="header-anchor" href="#what-it-does" aria-label="Permalink to &quot;What it does&quot;">​</a></h3><ul><li>Generates and stores the device binding ID.</li><li>Centralizes Firestore paths for device data.</li></ul><h3 id="how-it-runs" tabindex="-1">How it runs <a class="header-anchor" href="#how-it-runs" aria-label="Permalink to &quot;How it runs&quot;">​</a></h3><ul><li>Device ID is stored in <code>MDMSettings</code> as <code>device_binding_id</code>.</li><li>ID format: <code>device-&lt;uuid&gt;</code> (not ANDROID_ID).</li><li>Paths used: <ul><li>Device doc: <code>devices/{deviceId}</code>.</li><li>Config doc: <code>devices/{deviceId}/config/state/current/current</code>.</li><li>Apps collection: <code>devices/{deviceId}/apps</code>.</li><li>Commands collection: <code>devices/{deviceId}/commands</code>.</li></ul></li><li><code>markDeviceAlive()</code> updates status + <code>lastSeenMs</code> and optional <code>deviceInfo</code>.</li></ul><h2 id="device-admin-receiver-selection" tabindex="-1">Device admin receiver selection <a class="header-anchor" href="#device-admin-receiver-selection" aria-label="Permalink to &quot;Device admin receiver selection&quot;">​</a></h2><h3 id="where-it-lives-1" tabindex="-1">Where it lives <a class="header-anchor" href="#where-it-lives-1" aria-label="Permalink to &quot;Where it lives&quot;">​</a></h3><ul><li><code>app/src/main/java/com/tripleu/policy/DeviceAdminProvider.kt</code></li><li><code>app/src/main/java/com/tripleu/mdm/a.kt</code></li><li><code>app/src/main/java/com/tripleu/device/AdminReceiver.kt</code></li></ul><h3 id="what-it-does-1" tabindex="-1">What it does <a class="header-anchor" href="#what-it-does-1" aria-label="Permalink to &quot;What it does&quot;">​</a></h3><ul><li>Chooses which <code>DeviceAdminReceiver</code> component is active.</li><li>Supports a newer receiver (<code>com.tripleu.mdm.a</code>) and legacy <code>AdminReceiver</code>.</li></ul><h3 id="how-it-runs-1" tabindex="-1">How it runs <a class="header-anchor" href="#how-it-runs-1" aria-label="Permalink to &quot;How it runs&quot;">​</a></h3><ul><li><code>DeviceAdminProvider.admin()</code> checks <code>DevicePolicyManager.isAdminActive()</code>: <ul><li>Uses <code>com.tripleu.mdm.a</code> if active.</li><li>Falls back to <code>com.tripleu.device.AdminReceiver</code> if active.</li><li>Defaults to <code>com.tripleu.mdm.a</code>.</li></ul></li></ul><h2 id="policy-update-receiver-android-14" tabindex="-1">Policy update receiver (Android 14+) <a class="header-anchor" href="#policy-update-receiver-android-14" aria-label="Permalink to &quot;Policy update receiver (Android 14+)&quot;">​</a></h2><h3 id="where-it-lives-2" tabindex="-1">Where it lives <a class="header-anchor" href="#where-it-lives-2" aria-label="Permalink to &quot;Where it lives&quot;">​</a></h3><ul><li><code>app/src/main/java/com/tripleu/device/PolicyUpdateReceiver.kt</code></li><li><code>app/src/main/AndroidManifest.xml</code></li></ul><h3 id="what-it-does-2" tabindex="-1">What it does <a class="header-anchor" href="#what-it-does-2" aria-label="Permalink to &quot;What it does&quot;">​</a></h3><ul><li>Satisfies <code>ACTION_DEVICE_POLICY_SET_RESULT</code> broadcasts to stop system log spam.</li></ul><h3 id="how-it-runs-2" tabindex="-1">How it runs <a class="header-anchor" href="#how-it-runs-2" aria-label="Permalink to &quot;How it runs&quot;">​</a></h3><ul><li>Registered as a <code>PolicyUpdateReceiver</code>.</li><li><code>onPolicySetResult</code> and <code>onPolicyChanged</code> are no-ops.</li></ul><h2 id="device-info-uploader-imei" tabindex="-1">Device info uploader (IMEI) <a class="header-anchor" href="#device-info-uploader-imei" aria-label="Permalink to &quot;Device info uploader (IMEI)&quot;">​</a></h2><h3 id="where-it-lives-3" tabindex="-1">Where it lives <a class="header-anchor" href="#where-it-lives-3" aria-label="Permalink to &quot;Where it lives&quot;">​</a></h3><ul><li><code>app/src/main/java/com/tripleu/device/DeviceInfoUploader.kt</code></li></ul><h3 id="what-it-does-3" tabindex="-1">What it does <a class="header-anchor" href="#what-it-does-3" aria-label="Permalink to &quot;What it does&quot;">​</a></h3><ul><li>Uploads the device IMEI to Firestore for the signed-in user.</li></ul><h3 id="how-it-runs-3" tabindex="-1">How it runs <a class="header-anchor" href="#how-it-runs-3" aria-label="Permalink to &quot;How it runs&quot;">​</a></h3><ul><li>Only runs when: <ul><li>Firebase user is signed in.</li><li>App is device owner.</li><li><code>READ_PHONE_STATE</code> permission is granted.</li></ul></li><li>Reads IMEI via <code>TelephonyManager.imei</code>.</li><li>Writes to <code>users/{uid}.imei</code> and caches <code>imei_last</code> + <code>imei_uploaded</code> in <code>MDMSettings</code>.</li></ul><h2 id="device-owner-action-wrapper" tabindex="-1">Device-owner action wrapper <a class="header-anchor" href="#device-owner-action-wrapper" aria-label="Permalink to &quot;Device-owner action wrapper&quot;">​</a></h2><h3 id="where-it-lives-4" tabindex="-1">Where it lives <a class="header-anchor" href="#where-it-lives-4" aria-label="Permalink to &quot;Where it lives&quot;">​</a></h3><ul><li><code>app/src/main/java/com/tripleu/policy/DeviceOwnerActionExecutor.kt</code></li></ul><h3 id="what-it-does-4" tabindex="-1">What it does <a class="header-anchor" href="#what-it-does-4" aria-label="Permalink to &quot;What it does&quot;">​</a></h3><ul><li>Guards DPM actions behind a device-owner check.</li><li>Shows a failure toast (and optional success toast) unless <code>silent=true</code>.</li></ul><h3 id="how-it-runs-4" tabindex="-1">How it runs <a class="header-anchor" href="#how-it-runs-4" aria-label="Permalink to &quot;How it runs&quot;">​</a></h3><ul><li>Verifies <code>dpm.isDeviceOwnerApp(...)</code> before running the action.</li><li>Executes the action with the active admin component.</li><li>Catches exceptions and shows the failure message.</li></ul><h2 id="branding-frp-policy-controller" tabindex="-1">Branding + FRP policy controller <a class="header-anchor" href="#branding-frp-policy-controller" aria-label="Permalink to &quot;Branding + FRP policy controller&quot;">​</a></h2><h3 id="where-it-lives-5" tabindex="-1">Where it lives <a class="header-anchor" href="#where-it-lives-5" aria-label="Permalink to &quot;Where it lives&quot;">​</a></h3><ul><li><code>app/src/main/java/com/tripleu/policy/BrandingPolicyController.kt</code></li><li><code>app/src/main/java/com/tripleu/policy/PolicyManager.kt</code></li></ul><h3 id="what-it-does-5" tabindex="-1">What it does <a class="header-anchor" href="#what-it-does-5" aria-label="Permalink to &quot;What it does&quot;">​</a></h3><ul><li>Sets factory reset protection (FRP) accounts.</li><li>Sets organization name and optional lock screen message.</li></ul><h3 id="how-it-runs-5" tabindex="-1">How it runs <a class="header-anchor" href="#how-it-runs-5" aria-label="Permalink to &quot;How it runs&quot;">​</a></h3><ul><li>FRP accounts: <ul><li>Requires device owner and Android 9+.</li><li>Skips emulators and devices without <code>PersistentDataBlockManager</code>.</li><li>Applies <code>FactoryResetProtectionPolicy</code>.</li></ul></li><li>Branding: <ul><li>Requires device owner.</li><li>Sets org name on Android 8+ and lock screen message on Android 7+.</li></ul></li></ul><h2 id="default-policies-first-time-setup" tabindex="-1">Default policies (first-time setup) <a class="header-anchor" href="#default-policies-first-time-setup" aria-label="Permalink to &quot;Default policies (first-time setup)&quot;">​</a></h2><h3 id="where-it-lives-6" tabindex="-1">Where it lives <a class="header-anchor" href="#where-it-lives-6" aria-label="Permalink to &quot;Where it lives&quot;">​</a></h3><ul><li><code>app/src/main/java/com/tripleu/policy/DefaultPolicyHandler.kt</code></li><li><code>app/src/main/java/com/tripleu/ui/activities/PermissionsCheckActivity.kt</code></li><li><code>app/src/main/java/com/tripleu/ui/fragments/PrivacyFragment.kt</code></li></ul><h3 id="what-it-does-6" tabindex="-1">What it does <a class="header-anchor" href="#what-it-does-6" aria-label="Permalink to &quot;What it does&quot;">​</a></h3><ul><li>Applies one-time defaults after setup completes.</li><li>Blocks network reset.</li><li>Sets FRP accounts and organization branding.</li><li>Enables accessibility self-block.</li><li>Resets VPN and whitelist flags to off.</li></ul><h3 id="how-it-runs-6" tabindex="-1">How it runs <a class="header-anchor" href="#how-it-runs-6" aria-label="Permalink to &quot;How it runs&quot;">​</a></h3><ul><li>Runs once when device owner is active (API 28+).</li><li>Sets <code>UserManager.DISALLOW_NETWORK_RESET</code>.</li><li>Calls <code>PolicyManager.setFrpAccounts(setOf(&quot;tripleuworld@gmail.com&quot;))</code>.</li><li>Calls <code>PolicyManager.setOrganizationBranding(...)</code> (org name + lock screen message).</li><li>Writes prefs: <ul><li><code>network_reset_blocked=true</code></li><li><code>accessibility_self_block_enabled=true</code></li><li><code>default_policies_applied=true</code></li><li><code>is_vpn_on=false</code></li><li><code>whitelist_on=false</code></li></ul></li></ul>',50)])])}const m=i(l,[["render",r]]);export{p as __pageData,m as default};
