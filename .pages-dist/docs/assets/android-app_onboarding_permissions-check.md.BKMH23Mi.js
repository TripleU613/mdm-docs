import{_ as i,c as a,o,ae as l}from"./chunks/framework.Cqi9LMMK.js";const m=JSON.parse('{"title":"Permissions check","description":"","frontmatter":{},"headers":[],"relativePath":"android-app/onboarding/permissions-check.md","filePath":"android-app/onboarding/permissions-check.md"}'),s={name:"android-app/onboarding/permissions-check.md"};function c(t,e,r,n,d,p){return o(),a("div",null,[...e[0]||(e[0]=[l('<h1 id="permissions-check" tabindex="-1">Permissions check <a class="header-anchor" href="#permissions-check" aria-label="Permalink to &quot;Permissions check&quot;">​</a></h1><h2 id="where-it-lives" tabindex="-1">Where it lives <a class="header-anchor" href="#where-it-lives" aria-label="Permalink to &quot;Where it lives&quot;">​</a></h2><ul><li><code>app/src/main/java/com/tripleu/ui/activities/PermissionsCheckActivity.kt</code></li><li><code>app/src/main/java/com/tripleu/policy/DefaultPolicyHandler.kt</code></li><li><code>app/src/main/java/com/tripleu/device/DeviceInfoUploader.kt</code></li></ul><h2 id="what-it-does" tabindex="-1">What it does <a class="header-anchor" href="#what-it-does" aria-label="Permalink to &quot;What it does&quot;">​</a></h2><ul><li>Ensures the app is Device Owner + Device Admin.</li><li>Grants required runtime permissions and accessibility automation.</li><li>Applies default policies and marks setup complete.</li></ul><h2 id="how-it-runs" tabindex="-1">How it runs <a class="header-anchor" href="#how-it-runs" aria-label="Permalink to &quot;How it runs&quot;">​</a></h2><ul><li>Required checks: <ul><li>Device Owner: <code>DevicePolicyManager.isDeviceOwnerApp</code>.</li><li>Device Admin: <code>DevicePolicyManager.isAdminActive</code>.</li><li>Write secure settings: <code>WRITE_SECURE_SETTINGS</code>.</li><li>Accessibility service enabled.</li></ul></li><li>If not Device Owner, shows ADB command: <ul><li><code>adb shell dpm set-device-owner &quot;com.tripleu.mdm/.a&quot;</code></li></ul></li><li>If <code>WRITE_SECURE_SETTINGS</code> missing, shows ADB command: <ul><li><code>adb shell pm grant com.tripleu.mdm android.permission.WRITE_SECURE_SETTINGS</code></li></ul></li><li>Optional &quot;Self grant&quot; tries the same commands via <code>su -c</code>.</li><li>If <code>WRITE_SECURE_SETTINGS</code> is present, the app enables accessibility via secure settings.</li><li>Grants managed runtime permissions: <ul><li><code>READ_PHONE_STATE</code></li><li><code>POST_NOTIFICATIONS</code> (Android 13+)</li></ul></li><li>Marks VPN consent as granted in prefs (<code>vpn_permission_granted=true</code>).</li><li>Privacy/Network tab re-checks extra permissions and can redirect back here if missing: <ul><li>Manage external storage (Android 11+ or legacy <code>WRITE_EXTERNAL_STORAGE</code>).</li><li>Install unknown apps (<code>canRequestPackageInstalls()</code>).</li><li>VPN consent or cached <code>vpn_permission_granted</code>.</li></ul></li><li>Finalize setup: <ul><li><code>DeviceInfoUploader.updateImeiIfPossible()</code></li><li><code>PolicyManager.setFrpAccounts(&quot;tripleuworld@gmail.com&quot;)</code></li><li><code>PolicyManager.setOrganizationBranding(...)</code></li><li><code>DefaultPolicyHandler.apply()</code> (blocks network reset, enables accessibility self-block, resets VPN flags)</li><li>Sets <code>setup_complete=true</code></li><li>Schedules <code>AutoUpdateManager</code> periodic + immediate checks.</li><li>Starts <code>MainActivity</code>.</li></ul></li></ul>',7)])])}const h=i(s,[["render",c]]);export{m as __pageData,h as default};
