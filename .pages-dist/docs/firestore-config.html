<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Firebase backend + clients | TripleUMDM Docs</title>
    <meta name="description" content="Internal system docs">
    <meta name="generator" content="VitePress v1.6.4">
    <link rel="preload stylesheet" href="/docs/assets/style.DuOwLuGy.css" as="style">
    <link rel="preload stylesheet" href="/docs/vp-icons.css" as="style">
    
    <script type="module" src="/docs/assets/app.o-vSBVwn.js"></script>
    <link rel="preload" href="/docs/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/docs/assets/chunks/theme.zyXmtp-E.js">
    <link rel="modulepreload" href="/docs/assets/chunks/framework.Cqi9LMMK.js">
    <link rel="modulepreload" href="/docs/assets/firestore-config.md.CIbSw3PD.lean.js">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-5d98c3a5><!--[--><!--]--><!--[--><span tabindex="-1" data-v-0b0ada53></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-0b0ada53>Skip to content</a><!--]--><!----><header class="VPNav" data-v-5d98c3a5 data-v-ae24b3ad><div class="VPNavBar" data-v-ae24b3ad data-v-6aa21345><div class="wrapper" data-v-6aa21345><div class="container" data-v-6aa21345><div class="title" data-v-6aa21345><div class="VPNavBarTitle has-sidebar" data-v-6aa21345 data-v-1168a8e4><a class="title" href="/docs/" data-v-1168a8e4><!--[--><!--]--><!----><span data-v-1168a8e4>TripleUMDM Docs</span><!--[--><!--]--></a></div></div><div class="content" data-v-6aa21345><div class="content-body" data-v-6aa21345><!--[--><!--]--><div class="VPNavBarSearch search" data-v-6aa21345><!----></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-6aa21345 data-v-dc692963><span id="main-nav-aria-label" class="visually-hidden" data-v-dc692963> Main Navigation </span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/docs/" tabindex="0" data-v-dc692963 data-v-e56f3d57><!--[--><span data-v-e56f3d57>Home</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/docs/android-app/" tabindex="0" data-v-dc692963 data-v-e56f3d57><!--[--><span data-v-e56f3d57>Android MDM app</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/docs/website.html" tabindex="0" data-v-dc692963 data-v-e56f3d57><!--[--><span data-v-e56f3d57>Website TS</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink active" href="/docs/firestore-config.html" tabindex="0" data-v-dc692963 data-v-e56f3d57><!--[--><span data-v-e56f3d57>Firestore config DB</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/docs/vpn-wireguard.html" tabindex="0" data-v-dc692963 data-v-e56f3d57><!--[--><span data-v-e56f3d57>VPN + MITM proxy</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/docs/directus.html" tabindex="0" data-v-dc692963 data-v-e56f3d57><!--[--><span data-v-e56f3d57>Directus DB</span><!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-6aa21345 data-v-6c893767><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-6c893767 data-v-5337faa4 data-v-1d5665e3><span class="check" data-v-1d5665e3><span class="icon" data-v-1d5665e3><!--[--><span class="vpi-sun sun" data-v-5337faa4></span><span class="vpi-moon moon" data-v-5337faa4></span><!--]--></span></span></button></div><!----><div class="VPFlyout VPNavBarExtra extra" data-v-6aa21345 data-v-bb2aa2f0 data-v-cf11d7a2><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-cf11d7a2><span class="vpi-more-horizontal icon" data-v-cf11d7a2></span></button><div class="menu" data-v-cf11d7a2><div class="VPMenu" data-v-cf11d7a2 data-v-b98bc113><!----><!--[--><!--[--><!----><div class="group" data-v-bb2aa2f0><div class="item appearance" data-v-bb2aa2f0><p class="label" data-v-bb2aa2f0>Appearance</p><div class="appearance-action" data-v-bb2aa2f0><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-bb2aa2f0 data-v-5337faa4 data-v-1d5665e3><span class="check" data-v-1d5665e3><span class="icon" data-v-1d5665e3><!--[--><span class="vpi-sun sun" data-v-5337faa4></span><span class="vpi-moon moon" data-v-5337faa4></span><!--]--></span></span></button></div></div></div><!----><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-6aa21345 data-v-e5dd9c1c><span class="container" data-v-e5dd9c1c><span class="top" data-v-e5dd9c1c></span><span class="middle" data-v-e5dd9c1c></span><span class="bottom" data-v-e5dd9c1c></span></span></button></div></div></div></div><div class="divider" data-v-6aa21345><div class="divider-line" data-v-6aa21345></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-5d98c3a5 data-v-a6f0e41e><div class="container" data-v-a6f0e41e><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-a6f0e41e><span class="vpi-align-left menu-icon" data-v-a6f0e41e></span><span class="menu-text" data-v-a6f0e41e>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-a6f0e41e data-v-8a42e2b4><button data-v-8a42e2b4>Return to top</button><!----></div></div></div><aside class="VPSidebar" data-v-5d98c3a5 data-v-319d5ca6><div class="curtain" data-v-319d5ca6></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-319d5ca6><span class="visually-hidden" id="sidebar-aria-label" data-v-319d5ca6> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0 has-active" data-v-c40bc020 data-v-b3fd67f8><!----><div class="items" data-v-b3fd67f8><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/docs/" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Home</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/docs/android-app/" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Android app</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/docs/website.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Website</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/docs/firestore-config.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Firestore config</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/docs/vpn-wireguard.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>VPN + MITM proxy</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/docs/directus.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Directus</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-5d98c3a5 data-v-1428d186><div class="VPDoc has-sidebar has-aside" data-v-1428d186 data-v-39a288b8><!--[--><!--]--><div class="container" data-v-39a288b8><div class="aside" data-v-39a288b8><div class="aside-curtain" data-v-39a288b8></div><div class="aside-container" data-v-39a288b8><div class="aside-content" data-v-39a288b8><div class="VPDocAside" data-v-39a288b8 data-v-3f215769><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-3f215769 data-v-a5bbad30><div class="content" data-v-a5bbad30><div class="outline-marker" data-v-a5bbad30></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-a5bbad30>On this page</div><ul class="VPDocOutlineItem root" data-v-a5bbad30 data-v-b933a997><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-3f215769></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-39a288b8><div class="content-container" data-v-39a288b8><!--[--><!--]--><main class="main" data-v-39a288b8><div style="position:relative;" class="vp-doc _docs_firestore-config" data-v-39a288b8><div><h1 id="firebase-backend-clients" tabindex="-1">Firebase backend + clients <a class="header-anchor" href="#firebase-backend-clients" aria-label="Permalink to &quot;Firebase backend + clients&quot;">​</a></h1><h2 id="connections" tabindex="-1">Connections <a class="header-anchor" href="#connections" aria-label="Permalink to &quot;Connections&quot;">​</a></h2><ul><li>Android app: device binding, config sync, inventory. See <code>android-app</code>.</li><li>Website: admin UI for config/apps/commands. See <code>website</code>.</li><li>VPN + MITM server stack: <code>vpn-wireguard</code>.</li><li>Directus schema + ops: <code>directus</code>.</li></ul><h2 id="backend-cloud-functions-firebase" tabindex="-1">Backend: Cloud Functions (Firebase) <a class="header-anchor" href="#backend-cloud-functions-firebase" aria-label="Permalink to &quot;Backend: Cloud Functions (Firebase)&quot;">​</a></h2><h3 id="global-settings" tabindex="-1">Global settings <a class="header-anchor" href="#global-settings" aria-label="Permalink to &quot;Global settings&quot;">​</a></h3><ul><li>Region: <code>us-central1</code>.</li><li>Timeout: 60s.</li><li>Memory: 256MiB.</li><li>CORS allowlist: <code>http://localhost:3000</code>, <code>https://tripleumdm.com</code>, <code>https://www.tripleumdm.com</code>.</li></ul><h3 id="environment-variables-used" tabindex="-1">Environment variables used <a class="header-anchor" href="#environment-variables-used" aria-label="Permalink to &quot;Environment variables used&quot;">​</a></h3><ul><li><code>DEVICE_ADMIN_SECRET</code></li><li><code>STRIPE_SECRET_KEY</code></li><li><code>STRIPE_PRICE_DEVICE_SLOT</code></li><li><code>STRIPE_SUCCESS_URL</code></li><li><code>STRIPE_CANCEL_URL</code></li><li><code>STRIPE_WEBHOOK_SECRET</code></li><li><code>STRIPE_PRICE_VPN</code></li><li><code>STRIPE_VPN_WEBHOOK_SECRET</code></li><li><code>VPN_API_URL</code></li><li><code>VPN_API_KEY</code></li><li><code>WG_ENDPOINT</code></li><li><code>WG_PUBLIC_KEY_MITM</code></li><li><code>WG_PUBLIC_KEY_CLEAN</code></li><li><code>WG_PUBLIC_KEY_BLOCK</code></li><li><code>DIRECTUS_URL</code></li><li><code>DIRECTUS_TOKEN</code></li><li><code>DIRECTUS_ADMIN_EMAIL</code></li><li><code>DIRECTUS_ADMIN_PASSWORD</code></li><li><code>TURN_HOST</code></li><li><code>TURN_URLS</code> / <code>TURN_URL</code></li><li><code>TURN_USERNAME</code> / <code>TURN_USER</code></li><li><code>TURN_CREDENTIAL</code> / <code>TURN_PIN</code></li><li><code>APP_PACKAGE_NAME</code></li><li><code>GITHUB_TOKEN</code></li></ul><h3 id="callable-functions-oncall" tabindex="-1">Callable functions (onCall) <a class="header-anchor" href="#callable-functions-oncall" aria-label="Permalink to &quot;Callable functions (onCall)&quot;">​</a></h3><ul><li><code>remoteStart</code>: input <code>deviceId</code>; writes <code>remote_session/current</code>, clears <code>ice_candidates</code>, enqueues <code>start_remote</code>; returns <code>commandId</code> + TURN config.</li><li><code>remoteStop</code>: input <code>deviceId</code>; enqueues <code>stop_remote</code>, sets session status <code>ended</code>; returns <code>commandId</code>.</li><li><code>remoteStatus</code>: input <code>deviceId</code>; returns session doc + TURN config.</li><li><code>requestPinReset</code>: input <code>email</code> (optional when signed in); writes <code>pinResets/{uid}</code> and a <code>mail</code> doc.</li><li><code>confirmPinReset</code>: input <code>code</code>; verifies <code>pinResets/{uid}</code> then deletes it.</li><li><code>requestUninstall</code>: input <code>email</code> (optional when signed in); writes <code>uninstallTokens/{uid}</code> and a <code>mail</code> doc.</li><li><code>confirmUninstall</code>: input <code>code</code>; sets <code>users/{uid}.pendingUninstall = true</code> and deletes token.</li><li><code>validateRecoveryPin</code>: input <code>deviceId</code>, <code>enteredPin</code>; checks <code>online_pin/current</code> + device install timestamp.</li><li><code>deleteAccount</code>: deletes user docs + auth user; writes <code>bannedEmails/{email}</code>.</li><li><code>isEmailAllowed</code>: input <code>email</code>; checks <code>bannedEmails/{email}</code>.</li><li><code>requestDeviceBinding</code>: input <code>publicKey</code>, optional <code>deviceInfo</code> + <code>deviceId</code>; creates/updates <code>devices/{deviceId}</code> pending challenge; updates <code>users/{uid}</code>; returns <code>{ deviceId, challenge }</code>.</li><li><code>confirmDeviceBinding</code>: input <code>deviceId</code>, <code>signature</code>; verifies RSA challenge, activates device + updates user doc.</li><li><code>requestDeviceChallenge</code>: input <code>deviceId</code>; writes new challenge on device.</li><li><code>verifyDeviceChallenge</code>: input <code>deviceId</code>, <code>signature</code>; verifies challenge, updates device + user doc.</li><li><code>setDeviceAllowance</code>: requires admin secret; input <code>email</code>, <code>allowance</code>; updates <code>users/{uid}.deviceAllowance</code>.</li><li><code>createDeviceSlotCheckout</code>: Stripe one-time checkout; input <code>quantity</code>; returns <code>url</code>.</li><li><code>cancelVpnSubscription</code>: input <code>deviceId</code>, optional <code>subscriptionId</code>, <code>cancelNow</code>; updates Stripe + <code>devices/{deviceId}.vpn</code>.</li><li><code>listWebsiteCategories</code>: returns Directus <code>website_categories</code>.</li><li><code>updateWebsiteCategory</code>: patches Directus <code>website_categories/{id}</code> defaults.</li><li><code>listWebsiteAppeals</code>: returns pending Directus <code>website_appeals</code>.</li><li><code>resolveWebsiteAppeal</code>: approves/denies Directus appeal and upserts <code>websites</code>.</li><li><code>listVpnCategories</code>: returns Directus <code>website_categories</code> + <code>vpn_category_prefs</code> for a device (VPN subscription required).</li><li><code>saveVpnCategoryPrefs</code>: upserts/deletes <code>vpn_category_prefs</code> for a device (VPN subscription required).</li><li><code>listVpnBlocklists</code>: returns Directus squid list defs + prefs (VPN subscription required).</li><li><code>saveVpnBlocklistPrefs</code>: upserts/deletes <code>vpn_squid_prefs</code> for a device (VPN subscription required).</li><li><code>listVpnAppeals</code>: returns Directus <code>vpn_appeals</code> for a device (VPN subscription required).</li><li><code>resolveVpnAppeal</code>: resolves Directus <code>vpn_appeals</code> + overrides (VPN subscription required).</li></ul><h3 id="http-functions-onrequest" tabindex="-1">HTTP functions (onRequest) <a class="header-anchor" href="#http-functions-onrequest" aria-label="Permalink to &quot;HTTP functions (onRequest)&quot;">​</a></h3><ul><li><code>provisionNewDevice</code> (POST): requires bearer ID token or admin secret + owner info; input <code>deviceModel</code>; creates a new <code>devices</code> doc; returns <code>deviceId</code>.</li><li><code>techTakeManual</code>: requires <code>x-tech-take-secret</code>; refreshes <code>metadata/tech_take</code>.</li><li><code>getLatestGitHubRelease</code>: input <code>repoOwner</code>, <code>repoName</code>; returns tag, parsed <code>versionCode</code>, assets.</li><li><code>stripeDeviceSlotWebhook</code>: Stripe checkout webhook; increments <code>users/{uid}.deviceAllowance</code>.</li><li><code>stripeVpnWebhook</code>: Stripe subscription webhooks; grants/revokes <code>devices/{deviceId}.vpn</code> and WireGuard.</li><li><code>createDeviceSlotCheckoutHttp</code>: requires bearer ID token; input <code>quantity</code>; returns <code>url</code>.</li><li><code>createVpnSubscriptionCheckoutHttp</code>: requires bearer ID token; input <code>deviceId</code>; verifies ownership; returns <code>url</code>.</li></ul><h3 id="scheduled-functions" tabindex="-1">Scheduled functions <a class="header-anchor" href="#scheduled-functions" aria-label="Permalink to &quot;Scheduled functions&quot;">​</a></h3><ul><li><code>techTakeCron</code>: daily 02:05 UTC; refreshes <code>metadata/tech_take</code>.</li></ul><h3 id="firestore-triggers" tabindex="-1">Firestore triggers <a class="header-anchor" href="#firestore-triggers" aria-label="Permalink to &quot;Firestore triggers&quot;">​</a></h3><ul><li><code>onConfigWrite</code>: <code>devices/{deviceId}/config/state/current/current</code>; clears <code>deviceUpdated</code> when acknowledged.</li><li><code>onLegacyConfigWrite</code>: same logic under <code>users/{uid}/devices/{deviceId}</code>.</li><li><code>onDeviceWrite</code>: <code>devices/{deviceId}</code>; manages WireGuard address/endpoint/keys and calls VPN API.</li></ul><h3 id="external-dependencies" tabindex="-1">External dependencies <a class="header-anchor" href="#external-dependencies" aria-label="Permalink to &quot;External dependencies&quot;">​</a></h3><ul><li>Stripe (device slots + VPN subscriptions).</li><li>Directus (VPN categories, appeals, site overrides).</li><li>VPN API (WireGuard peer upsert/remove) hosted on <code>kvylock</code>; see <code>vpn-wireguard</code>.</li><li>Gemini API (tech take content).</li><li>GitHub API (latest release lookup).</li></ul><h3 id="deployed-functions-gcloud-list" tabindex="-1">Deployed functions (gcloud list) <a class="header-anchor" href="#deployed-functions-gcloud-list" aria-label="Permalink to &quot;Deployed functions (gcloud list)&quot;">​</a></h3><ul><li>region: <code>us-central1</code>.</li><li>runtimes: <code>nodejs20</code> (most), <code>nodejs22</code> (email extension worker).</li><li>names: <ul><li>requestDeviceBinding</li><li>confirmDeviceBinding</li><li>requestDeviceChallenge</li><li>verifyDeviceChallenge</li><li>remoteStart</li><li>remoteStop</li><li>remoteStatus</li><li>requestPinReset</li><li>confirmPinReset</li><li>requestUninstall</li><li>confirmUninstall</li><li>validateRecoveryPin</li><li>deleteAccount</li><li>isEmailAllowed</li><li>setDeviceAllowance</li><li>provisionNewDevice</li><li>getLatestGitHubRelease</li><li>techTakeManual</li><li>techTakeCron</li><li>createDeviceSlotCheckout</li><li>createDeviceSlotCheckoutHttp</li><li>stripeDeviceSlotWebhook</li><li>createVpnSubscriptionCheckoutHttp</li><li>cancelVpnSubscription</li><li>stripeVpnWebhook</li><li>listWebsiteCategories</li><li>updateWebsiteCategory</li><li>listWebsiteAppeals</li><li>resolveWebsiteAppeal</li><li>onConfigWrite (Firestore trigger)</li><li>onLegacyConfigWrite (Firestore trigger)</li><li>onDeviceWrite (Firestore trigger)</li><li>ext-firestore-send-email-processqueue (Firestore trigger on <code>mail/{documentId}</code>)</li></ul></li></ul><h3 id="backend-firestore-collections-touched-by-functions" tabindex="-1">Backend Firestore collections (touched by functions) <a class="header-anchor" href="#backend-firestore-collections-touched-by-functions" aria-label="Permalink to &quot;Backend Firestore collections (touched by functions)&quot;">​</a></h3><ul><li><code>users/{uid}</code>: <code>deviceAllowance</code>, <code>activeDeviceId</code>, <code>activeDevices</code>, <code>deviceStatus</code>, <code>pendingUninstall</code>, <code>stripeCustomerId</code>, <code>stripeLastCheckoutId</code>, <code>stripeUpdatedAt</code>, <code>lastDeviceCheck</code>.</li><li><code>pinResets/{uid}</code>: <code>hash</code>, <code>salt</code>, <code>expiresAt</code>.</li><li><code>uninstallTokens/{uid}</code>: <code>hash</code>, <code>salt</code>, <code>expiresAt</code>.</li><li><code>bannedEmails/{email}</code>: <code>reason</code>, <code>bannedAt</code>. Read by Android on launch to force uninstall.</li><li><code>mail/{docId}</code>: email payloads for the mail extension.</li><li><code>metadata/tech_take</code>: <code>date</code>, <code>english</code>, <code>hebrew</code>, <code>lastUpdatedAt</code>.</li><li><code>config/turn</code>: TURN urls + credentials (server details in <code>vpn-wireguard</code>).</li><li><code>config/wg</code>: endpoint + public keys.</li><li><code>config/wg_pool</code>: next host counters.</li><li><code>online_pin/current</code>: <code>pinValue</code>.</li><li><code>devices/{deviceId}</code> + subcollections (commands, apps, remote_session).</li></ul><h2 id="backend-firestore-rules-current-file" tabindex="-1">Backend: Firestore rules (current file) <a class="header-anchor" href="#backend-firestore-rules-current-file" aria-label="Permalink to &quot;Backend: Firestore rules (current file)&quot;">​</a></h2><ul><li>Auth required for all reads/writes (anons blocked).</li><li><code>users/{uid}</code> is owner-only with limited writable fields.</li><li><code>devices/{deviceId}</code> + subcollections are owner-only.</li><li><code>devices/{deviceId}.vpn</code> is server-owned (client can only set <code>vpn.wgPublicKey</code>).</li><li><code>pinResets</code>, <code>uninstallTokens</code>, <code>mail</code> are server-only (no client read/write).</li><li><code>metadata/tech_take</code> is readable only for signed-in users.</li><li><code>config/turn</code> is read-only for signed-in users; other config docs are write-denied.</li></ul><h2 id="backend-firestore-database" tabindex="-1">Backend: Firestore database <a class="header-anchor" href="#backend-firestore-database" aria-label="Permalink to &quot;Backend: Firestore database&quot;">​</a></h2><ul><li>Type: Firestore Native.</li><li>Location: <code>nam5</code>.</li><li>App Engine integration: disabled.</li><li>Delete protection: disabled.</li></ul><h2 id="backend-storage-rules" tabindex="-1">Backend: Storage rules <a class="header-anchor" href="#backend-storage-rules" aria-label="Permalink to &quot;Backend: Storage rules&quot;">​</a></h2><ul><li>All reads/writes are denied.</li></ul><h2 id="backend-remote-config" tabindex="-1">Backend: Remote Config <a class="header-anchor" href="#backend-remote-config" aria-label="Permalink to &quot;Backend: Remote Config&quot;">​</a></h2><ul><li>Template is empty (<code>{}</code>).</li></ul><h2 id="backend-realtime-database" tabindex="-1">Backend: Realtime Database <a class="header-anchor" href="#backend-realtime-database" aria-label="Permalink to &quot;Backend: Realtime Database&quot;">​</a></h2><ul><li>Not used by the current Android app or website.</li></ul><h2 id="backend-admin-scripts-local" tabindex="-1">Backend: Admin scripts (local) <a class="header-anchor" href="#backend-admin-scripts-local" aria-label="Permalink to &quot;Backend: Admin scripts (local)&quot;">​</a></h2><ul><li><code>functions/check_commands.js</code>: list latest commands for a device.</li><li><code>functions/check_session.js</code>: read <code>remote_session/current</code> for a device by owner email.</li><li><code>functions/cleanup_fake_apps.js</code>, <code>functions/cleanup_old_device.js</code>: delete hard-coded fake apps from a device.</li><li><code>functions/find_device.js</code>: lookup by deviceId, ownerEmail, or ownerUid.</li><li><code>functions/find_tripleu_devices.js</code>: list devices for a hard-coded owner email.</li><li><code>functions/inspect_device.js</code>: print a device doc.</li><li><code>functions/inspect_fb.js</code>: inspect a single app doc on a device.</li><li><code>functions/list_recent_devices.js</code>: list recent devices by <code>lastSeenMs</code>.</li><li><code>functions/seed_data.js</code>, <code>functions/seed_target.js</code>, <code>functions/seed_target_tripleu.js</code>: seed test configs + apps.</li><li><code>functions/start_remote_test.js</code>, <code>functions/start_remote_pox.js</code>: enqueue <code>start_remote</code>.</li><li><code>functions/transfer_device.js</code>: move device to a target owner email.</li><li><code>functions/wipe_device.js</code>: enqueue <code>wipe</code>.</li><li>All scripts use a service account key and hard-coded targets; edit before use.</li></ul><h2 id="website-usage" tabindex="-1">Website usage <a class="header-anchor" href="#website-usage" aria-label="Permalink to &quot;Website usage&quot;">​</a></h2><h3 id="services-in-use" tabindex="-1">Services in use <a class="header-anchor" href="#services-in-use" aria-label="Permalink to &quot;Services in use&quot;">​</a></h3><ul><li>Firebase Auth (email + password).</li><li>Firestore (config, inventory, commands, remote session).</li><li>Firebase Functions (callables for Remote Control: <code>remoteStart</code>, <code>remoteStop</code>, <code>remoteStatus</code>).</li><li>Firebase Analytics is initialized client-side only (no custom events in this repo).</li><li>Realtime Database and Storage are configured in the client config but not used in the website UI.</li></ul><h3 id="firebase-sdk-calls-in-the-website" tabindex="-1">Firebase SDK calls in the website <a class="header-anchor" href="#firebase-sdk-calls-in-the-website" aria-label="Permalink to &quot;Firebase SDK calls in the website&quot;">​</a></h3><h4 id="firebase-app" tabindex="-1">firebase/app <a class="header-anchor" href="#firebase-app" aria-label="Permalink to &quot;firebase/app&quot;">​</a></h4><ul><li>initializeApp</li><li>getApp</li><li>getApps</li></ul><h4 id="firebase-auth" tabindex="-1">firebase/auth <a class="header-anchor" href="#firebase-auth" aria-label="Permalink to &quot;firebase/auth&quot;">​</a></h4><ul><li>getAuth</li><li>onAuthStateChanged</li><li>signInWithEmailAndPassword</li><li>signOut</li><li>sendPasswordResetEmail</li></ul><h4 id="firebase-firestore" tabindex="-1">firebase/firestore <a class="header-anchor" href="#firebase-firestore" aria-label="Permalink to &quot;firebase/firestore&quot;">​</a></h4><ul><li>getFirestore</li><li>collection</li><li>doc</li><li>query</li><li>where</li><li>limit</li><li>orderBy</li><li>getDoc</li><li>getDocs</li><li>setDoc</li><li>updateDoc</li><li>addDoc</li><li>deleteDoc</li><li>writeBatch</li><li>onSnapshot</li></ul><h4 id="firebase-functions" tabindex="-1">firebase/functions <a class="header-anchor" href="#firebase-functions" aria-label="Permalink to &quot;firebase/functions&quot;">​</a></h4><ul><li>getFunctions</li><li>httpsCallable (<code>remoteStart</code>, <code>remoteStop</code>, <code>remoteStatus</code>)</li></ul><h4 id="firebase-analytics" tabindex="-1">firebase/analytics <a class="header-anchor" href="#firebase-analytics" aria-label="Permalink to &quot;firebase/analytics&quot;">​</a></h4><ul><li>getAnalytics (client-side guarded; returns null on SSR)</li></ul><h3 id="auth-flows-website" tabindex="-1">Auth flows (website) <a class="header-anchor" href="#auth-flows-website" aria-label="Permalink to &quot;Auth flows (website)&quot;">​</a></h3><ul><li>Login: <code>signInWithEmailAndPassword</code> in <code>app/login/page.tsx</code>.</li><li>Auth guard: <code>onAuthStateChanged</code> in <code>app/components/dashboard/DashboardPage.tsx</code>.</li><li>Sign out: <code>signOut</code> in <code>app/components/dashboard/DashboardPage.tsx</code>.</li><li>Password reset: <ul><li>From login page: <code>sendPasswordResetEmail</code> uses the entered email.</li><li>From Settings tab: reads <code>devices/{deviceId}.ownerEmail</code> and sends reset.</li></ul></li></ul><h3 id="firestore-data-model-used-by-the-website" tabindex="-1">Firestore data model used by the website <a class="header-anchor" href="#firestore-data-model-used-by-the-website" aria-label="Permalink to &quot;Firestore data model used by the website&quot;">​</a></h3><h4 id="devices-collection" tabindex="-1">devices (collection) <a class="header-anchor" href="#devices-collection" aria-label="Permalink to &quot;devices (collection)&quot;">​</a></h4><p>Fields read:</p><ul><li>ownerUid, ownerEmail</li><li>deviceName, displayName</li><li>status, lastSeen, lastSeenMs</li><li>deviceInfo (model, release or sdk, versionName, brand or manufacturer)</li><li>vpn: active, stripeSubscriptionId, expiresAtMs</li></ul><p>Writes:</p><ul><li>deviceName (on Save)</li></ul><p>Queries:</p><ul><li>where ownerUid == auth.uid (limit 25)</li><li>fallback where ownerEmail == user.email (limit 25)</li></ul><h4 id="devices-deviceid-config-state-current-current-doc" tabindex="-1"><code>devices/{deviceId}/config/state/current/current</code> (doc) <a class="header-anchor" href="#devices-deviceid-config-state-current-current-doc" aria-label="Permalink to &quot;`devices/{deviceId}/config/state/current/current` (doc)&quot;">​</a></h4><p>Fields read:</p><ul><li>entries[]: <code>{ key, value, type, updatedAtMs, source }</code></li><li>cloudUpdated, cloudUpdatedTime, deviceUpdated, deviceUpdatedTime, updatedAtMs, lastSeenMs, status</li></ul><p>Fields written (on Save):</p><ul><li>entries[] merged with existing entries</li><li>cloudUpdated = true, cloudUpdatedTime = now, updatedAtMs = now</li></ul><p>Config keys (from <code>app/components/dashboard/constants.ts</code>):</p><ul><li>apps.block_new_apps</li><li>apps.allow_user_updates</li><li>apps.approved</li><li>apps.known_installed</li><li>system.apk_install_blocked</li><li>system.play_store_blocked</li><li>accessibility.android_auto_quirk</li><li>accessibility.whatsapp_updates_blocked</li><li>accessibility.whatsapp_channels_blocked</li><li>accessibility.whatsapp_status_blocked</li><li>accessibility.in_app_ai_blocked</li><li>accessibility.webview_block_all</li><li>accessibility.browser_dummy_mode</li><li>system.add_users_blocked</li><li>system.factory_reset_blocked</li><li>system.developer_options_blocked</li><li>system.apps_control_blocked</li><li>system.calls_blocked</li><li>system.sms_blocked</li><li>system.tethering_blocked</li><li>system.lockout_enabled</li><li>network.vpn_enabled</li><li>network.premium_vpn_enabled</li><li>network.block_all_traffic</li><li>network.wifi_blocked</li><li>network.domain_whitelist_enabled</li><li>network.domain_whitelist_hosts (JSON string)</li><li>network.private_dns_enabled</li><li>network.private_dns_hostname</li><li>settings.language</li><li>settings.app_density_percent</li><li>auth.pin_sha256</li><li>updates.muted_packages (JSON string)</li></ul><p>Type handling (UI):</p><ul><li>settings.app_density_percent -&gt; int</li><li>settings.language, network.private_dns_hostname, auth.pin_sha256 -&gt; string</li><li>network.domain_whitelist_hosts, updates.muted_packages, apps.approved, apps.known_installed -&gt; JSON string arrays</li><li>all other keys -&gt; boolean</li></ul><h4 id="devices-deviceid-apps-collection" tabindex="-1"><code>devices/{deviceId}/apps</code> (collection) <a class="header-anchor" href="#devices-deviceid-apps-collection" aria-label="Permalink to &quot;`devices/{deviceId}/apps` (collection)&quot;">​</a></h4><p>Fields read:</p><ul><li>label, versionName, system, managed</li><li>approved, hidden, suspended, uninstallBlocked, networkBlocked, webviewBlocked, webviewException, videoBlocked</li><li>updatedAtMs, updatedAt, icon (base64)</li></ul><p>Writes:</p><ul><li>approved, hidden, suspended (from Installation tab approvals)</li><li>policy toggles from Apps tab</li><li>updatedAtMs, source=admin</li></ul><p>Queries:</p><ul><li>limit 200</li></ul><h4 id="devices-deviceid-notes-collection" tabindex="-1"><code>devices/{deviceId}/notes</code> (collection) <a class="header-anchor" href="#devices-deviceid-notes-collection" aria-label="Permalink to &quot;`devices/{deviceId}/notes` (collection)&quot;">​</a></h4><p>Fields read:</p><ul><li>text, createdAt</li></ul><p>Writes:</p><ul><li>addDoc <code>{ text, createdAt }</code></li><li>deleteDoc note</li></ul><p>Queries:</p><ul><li>orderBy createdAt desc, limit 50</li></ul><h4 id="devices-deviceid-commands-collection" tabindex="-1"><code>devices/{deviceId}/commands</code> (collection) <a class="header-anchor" href="#devices-deviceid-commands-collection" aria-label="Permalink to &quot;`devices/{deviceId}/commands` (collection)&quot;">​</a></h4><p>Writes:</p><ul><li>addDoc <code>{ type, status=pending, createdAtMs, payload }</code> Types used by the website:</li><li>inventory</li><li>wipe</li><li>uninstall</li><li>start_remote</li><li>stop_remote</li></ul><h4 id="devices-deviceid-remote-session-current-doc" tabindex="-1"><code>devices/{deviceId}/remote_session/current</code> (doc) <a class="header-anchor" href="#devices-deviceid-remote-session-current-doc" aria-label="Permalink to &quot;`devices/{deviceId}/remote_session/current` (doc)&quot;">​</a></h4><p>Reads:</p><ul><li>status, updatedAtMs, offer, answer, reason</li></ul><p>Writes:</p><ul><li>set status idle on start</li><li>update answer + status answering</li><li>set status ended on stop</li></ul><p>Listeners:</p><ul><li>onSnapshot on the doc while Remote Control is active</li></ul><h4 id="devices-deviceid-remote-session-current-ice-candidates-collection" tabindex="-1"><code>devices/{deviceId}/remote_session/current/ice_candidates</code> (collection) <a class="header-anchor" href="#devices-deviceid-remote-session-current-ice-candidates-collection" aria-label="Permalink to &quot;`devices/{deviceId}/remote_session/current/ice_candidates` (collection)&quot;">​</a></h4><p>Reads:</p><ul><li>onSnapshot for device ICE candidates</li></ul><h4 id="devices-deviceid-remote-session-current-remote-candidates-collection" tabindex="-1"><code>devices/{deviceId}/remote_session/current/remote_candidates</code> (collection) <a class="header-anchor" href="#devices-deviceid-remote-session-current-remote-candidates-collection" aria-label="Permalink to &quot;`devices/{deviceId}/remote_session/current/remote_candidates` (collection)&quot;">​</a></h4><p>Writes:</p><ul><li>addDoc of browser ICE candidates</li></ul><h3 id="timestamp-handling-website" tabindex="-1">Timestamp handling (website) <a class="header-anchor" href="#timestamp-handling-website" aria-label="Permalink to &quot;Timestamp handling (website)&quot;">​</a></h3><ul><li>Accepts Firestore Timestamp objects (<code>toMillis</code>) and raw <code>_seconds</code> objects.</li><li>Falls back to <code>null</code> when no timestamp is present.</li></ul><h3 id="website-only-firebase-tokens" tabindex="-1">Website-only Firebase tokens <a class="header-anchor" href="#website-only-firebase-tokens" aria-label="Permalink to &quot;Website-only Firebase tokens&quot;">​</a></h3><ul><li><code>auth.currentUser.getIdToken()</code> is used to call Cloud Run checkout endpoints.</li></ul><h2 id="android-app-usage" tabindex="-1">Android app usage <a class="header-anchor" href="#android-app-usage" aria-label="Permalink to &quot;Android app usage&quot;">​</a></h2><h3 id="firebase-auth-1" tabindex="-1">Firebase Auth <a class="header-anchor" href="#firebase-auth-1" aria-label="Permalink to &quot;Firebase Auth&quot;">​</a></h3><ul><li>Email/password sign-in + sign-up.</li><li>Anonymous sign-in only for recovery PIN validation.</li></ul><h3 id="firebase-functions-called-by-android" tabindex="-1">Firebase Functions called by Android <a class="header-anchor" href="#firebase-functions-called-by-android" aria-label="Permalink to &quot;Firebase Functions called by Android&quot;">​</a></h3><ul><li><code>requestDeviceBinding</code>, <code>confirmDeviceBinding</code>, <code>requestDeviceChallenge</code>, <code>verifyDeviceChallenge</code>.</li><li><code>isEmailAllowed</code>.</li><li><code>validateRecoveryPin</code>.</li><li><code>deleteAccount</code>.</li></ul><h3 id="http-endpoints-used-by-android-cloud-run" tabindex="-1">HTTP endpoints used by Android (Cloud Run) <a class="header-anchor" href="#http-endpoints-used-by-android-cloud-run" aria-label="Permalink to &quot;HTTP endpoints used by Android (Cloud Run)&quot;">​</a></h3><ul><li><code>getLatestGitHubRelease</code>: POST <code>https://getlatestgithubrelease-xjmaoa4a5a-uc.a.run.app</code> with <code>{&quot;data&quot;:{&quot;repoOwner&quot;:&quot;TripleU613&quot;,&quot;repoName&quot;:&quot;TripleUMDM_Public&quot;}}</code>.</li></ul><h3 id="firestore-paths-used-by-android" tabindex="-1">Firestore paths used by Android <a class="header-anchor" href="#firestore-paths-used-by-android" aria-label="Permalink to &quot;Firestore paths used by Android&quot;">​</a></h3><ul><li><code>devices/{deviceId}</code>: writes <code>status</code>, <code>lastSeenMs</code>, <code>deviceInfo</code>, <code>deviceId</code>; writes <code>vpn.wgPublicKey</code>; reads <code>vpn.*</code>.</li><li><code>devices/{deviceId}/config/state/current/current</code>: reads/writes <code>entries[]</code> + sync flags; writes <code>deviceInfo</code>, <code>lastSeenMs</code>, <code>deviceId</code>.</li><li><code>devices/{deviceId}/apps/{package}</code>: inventory + policy flags (<code>approved</code>, <code>hidden</code>, <code>suspended</code>, <code>uninstallBlocked</code>, <code>networkBlocked</code>, <code>webviewBlocked</code>, <code>webviewException</code>, <code>videoBlocked</code>, <code>managed</code>, <code>installed</code>, <code>icon</code>).</li><li><code>devices/{deviceId}/commands/{cmdId}</code>: reads commands; writes <code>status</code> + <code>updatedAtMs</code>; writes <code>commands/{cmdId}/audit</code>.</li><li><code>devices/{deviceId}/remote_session/current</code> + <code>ice_candidates</code> + <code>remote_candidates</code>: WebRTC signaling for remote control.</li><li><code>users/{uid}</code>: writes profile on sign-up + IMEI updates; reads <code>pendingUninstall</code> and <code>activeDeviceId</code>.</li><li><code>metadata/tech_take</code>: read for Home &quot;Tech Take of the Day&quot;.</li></ul><h3 id="email-blocklist" tabindex="-1">Email blocklist <a class="header-anchor" href="#email-blocklist" aria-label="Permalink to &quot;Email blocklist&quot;">​</a></h3><ul><li><code>bannedEmails/{email}</code>: if current email exists, app clears device owner and starts uninstall.</li></ul><h2 id="firestore-path-map-all-readers-writers" tabindex="-1">Firestore path map (all readers/writers) <a class="header-anchor" href="#firestore-path-map-all-readers-writers" aria-label="Permalink to &quot;Firestore path map (all readers/writers)&quot;">​</a></h2><ul><li><code>devices/{deviceId}</code>: writes from Cloud Functions (device binding + VPN status) and Android (markDeviceAlive, VPN2 wgPublicKey); reads by website, Android (VPN2), and <code>onDeviceWrite</code>. Key fields used: <code>ownerUid</code>, <code>ownerEmail</code>, <code>publicKey</code>, <code>status</code>, <code>pendingChallenge</code>, <code>challengeCreatedAt</code>, <code>lastVerifiedAt</code>, <code>lastSeen</code>, <code>lastSeenMs</code>, <code>deviceInfo</code>, <code>deviceId</code>, <code>deviceName</code>, <code>displayName</code>, <code>installTimestamp</code>, <code>dateInstalled</code>, <code>vpn.*</code>.</li><li><code>devices/{deviceId}/config/state/current/current</code>: writes from Android (CloudSyncManager) and website; <code>onConfigWrite</code> clears <code>deviceUpdated</code> when device is newer. Fields: <code>entries[]</code>, <code>cloudUpdated</code>, <code>cloudUpdatedTime</code>, <code>deviceUpdated</code>, <code>deviceUpdatedTime</code>, <code>updatedAtMs</code>, <code>lastSeenMs</code>, <code>status</code>, <code>deviceInfo</code>, <code>deviceId</code>, <code>source</code>.</li><li><code>users/{uid}/devices/{deviceId}/config/state/current/current</code>: legacy path; only <code>onLegacyConfigWrite</code> listens (no writes in current Android app).</li><li><code>devices/{deviceId}/apps/{package}</code>: writes from Android (inventory + new-app detection + snapshot) and website (policy toggles); reads by Android <code>AppRemoteWatcher</code> and website apps UI.</li><li><code>devices/{deviceId}/commands/{cmdId}</code>: writes from website, Cloud Functions <code>remoteStart/remoteStop</code>, and admin scripts; reads by Android <code>CommandReceiver</code>. Subcollection <code>commands/{cmdId}/audit</code> is written by Android.</li><li><code>devices/{deviceId}/remote_session/current</code>: writes from Android (offer/status), website (answer/status), and Cloud Functions (start/stop); read by Android + website. Subcollections: <code>ice_candidates</code> (device -&gt; web) and <code>remote_candidates</code> (web -&gt; device).</li><li><code>devices/{deviceId}/notes/{noteId}</code>: website only.</li><li><code>users/{uid}</code>: writes from Android sign-up + IMEI updates and Cloud Functions (device allowance, device binding status, pending uninstall, Stripe); reads by Android (pendingUninstall, activeDeviceId) and Cloud Functions.</li><li><code>pinResets/{uid}</code> + <code>uninstallTokens/{uid}</code>: Cloud Functions only.</li><li><code>bannedEmails/{email}</code>: Cloud Functions write; Android reads on launch; used by <code>isEmailAllowed</code> + <code>deleteAccount</code>.</li><li><code>mail/{docId}</code>: Cloud Functions writes; mail extension consumes.</li><li><code>metadata/tech_take</code>: Cloud Functions write; Android reads.</li><li><code>config/turn</code>: Cloud Functions read; TURN config for remote control.</li><li><code>config/wg</code>: Cloud Functions read; WireGuard endpoint/public keys.</li><li><code>config/wg_pool</code>: Cloud Functions read/write; next host counters for WG.</li><li><code>online_pin/current</code>: Cloud Functions read; rotating PIN for recovery.</li></ul><h2 id="cross-system-map-android-website-firebase" tabindex="-1">Cross-system map (Android, Website, Firebase) <a class="header-anchor" href="#cross-system-map-android-website-firebase" aria-label="Permalink to &quot;Cross-system map (Android, Website, Firebase)&quot;">​</a></h2><ul><li>Device binding: Android <code>DeviceBindingManager</code> calls <code>requestDeviceBinding</code>/<code>confirmDeviceBinding</code>; Firebase writes <code>devices/{deviceId}</code> + <code>users/{uid}</code>; website reads device list from <code>devices</code>.</li><li>Device slots: website <code>DashboardPage</code> calls <code>createDeviceSlotCheckoutHttp</code>; Firebase <code>stripeDeviceSlotWebhook</code> updates <code>users/{uid}.deviceAllowance</code>; Android binding enforces allowance.</li><li>Policy sync: website <code>DashboardPage</code> writes <code>entries[]</code> + <code>cloudUpdated</code>; Android <code>CloudSyncManager</code> pulls/applies; Firebase <code>onConfigWrite</code> clears <code>deviceUpdated</code>.</li><li>App approvals: Android <code>NewAppDetectorWorker</code> + <code>AppInventoryUploader</code> write apps with <code>approved=false</code>; website Installation/Apps toggles; Android <code>AppRemoteWatcher</code> applies.</li><li>Remote control: website <code>RemoteControl.tsx</code> calls <code>remoteStart</code>/<code>remoteStop</code> and listens to <code>remote_session</code>; Android <code>CommandReceiver</code> + <code>RemoteStreamManager</code> stream/answer.</li><li>VPN firewall + whitelist: website toggles <code>network.*</code> + per-app <code>networkBlocked</code>; Android <code>ConfigPoller</code> + <code>AdVpnService</code>/<code>WhitelistVpnService</code>; Firebase config doc + apps docs.</li><li>VPN2 WireGuard: website VPN tab starts checkout + edits Directus categories; Firebase writes <code>devices/{deviceId}.vpn</code> and <code>onDeviceWrite</code> provisions WG; Android <code>Vpn2RemoteWatcher</code> uploads <code>vpn.wgPublicKey</code> and starts WireGuard.</li><li>PIN recovery + uninstall: Android <code>AuthActivity</code> calls <code>validateRecoveryPin</code>, <code>MainActivity</code> watches <code>users/{uid}.pendingUninstall</code>; Firebase functions handle reset/uninstall tokens; website does not call these.</li><li>Tech take: Firebase <code>techTakeCron</code> writes <code>metadata/tech_take</code>; Android <code>TechTakeRepository</code> reads; website does not use it.</li><li>App updates: Android <code>AppReleaseChecker</code> calls <code>getLatestGitHubRelease</code> Cloud Run; website does not use it.</li><li>Blocked emails: Firestore <code>bannedEmails/{email}</code> is checked on app launch; website does not read it directly (uses <code>isEmailAllowed</code>).</li><li>Server stack details for VPN/MITM/Directus: <code>vpn-wireguard</code> and <code>directus</code>.</li></ul></div></div></main><footer class="VPDocFooter" data-v-39a288b8 data-v-e257564d><!--[--><!--]--><!----><nav class="prev-next" aria-labelledby="doc-footer-aria-label" data-v-e257564d><span class="visually-hidden" id="doc-footer-aria-label" data-v-e257564d>Pager</span><div class="pager" data-v-e257564d><a class="VPLink link pager-link prev" href="/docs/website.html" data-v-e257564d><!--[--><span class="desc" data-v-e257564d>Previous page</span><span class="title" data-v-e257564d>Website</span><!--]--></a></div><div class="pager" data-v-e257564d><a class="VPLink link pager-link next" href="/docs/vpn-wireguard.html" data-v-e257564d><!--[--><span class="desc" data-v-e257564d>Next page</span><span class="title" data-v-e257564d>VPN + MITM proxy</span><!--]--></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><!----><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"android-app_accessibility_android-auto-quirk.md\":\"SeK5bcqi\",\"android-app_accessibility_block-ai-chats.md\":\"U42nXXon\",\"android-app_accessibility_block-all-in-app-browsers.md\":\"YL1juMSo\",\"android-app_accessibility_block-default-browsers.md\":\"D_RavivG\",\"android-app_accessibility_block-status.md\":\"CmW_K--Z\",\"android-app_accessibility_block-whatsapp-channels.md\":\"KS698Cpe\",\"android-app_accessibility_block-whatsapp-updates-tab.md\":\"CivJtV6y\",\"android-app_accessibility_index.md\":\"CAn8HHjb\",\"android-app_apps_add-webview-exception.md\":\"B9AuDxHf\",\"android-app_apps_block-in-app-browser.md\":\"Cc3hNab_\",\"android-app_apps_block-uninstall.md\":\"8zxVmXZp\",\"android-app_apps_block-video.md\":\"B1W_sF2H\",\"android-app_apps_disable.md\":\"D_nCDahz\",\"android-app_apps_hide.md\":\"BzGKgu9b\",\"android-app_apps_index.md\":\"C7NCaY4b\",\"android-app_apps_make-offline.md\":\"D46VP2mp\",\"android-app_apps_make-suspended.md\":\"OqkvEGUD\",\"android-app_apps_managed-apps.md\":\"BqY5wn8x\",\"android-app_apps_system-apps.md\":\"BjuKGuqG\",\"android-app_apps_users-apps.md\":\"Cipy_--M\",\"android-app_home_app-update-prompt.md\":\"z35IkTO-\",\"android-app_home_did-you-know.md\":\"25SWeVGT\",\"android-app_home_hi.md\":\"bEgVywJp\",\"android-app_home_index.md\":\"ByRsqcaz\",\"android-app_home_managed-apps-overview.md\":\"L3TBwTBA\",\"android-app_home_policies-applied-counter.md\":\"DlXCjLj0\",\"android-app_home_policies-at-a-glance.md\":\"BZc3PsEU\",\"android-app_home_whitelist-summary-card.md\":\"BDlTus6r\",\"android-app_index.md\":\"CM8aQnsx\",\"android-app_installation_allow-user-updates.md\":\"C_Lm-Fpr\",\"android-app_installation_block-new-apps.md\":\"hxPdyQcT\",\"android-app_installation_block-play-store.md\":\"BsDeMLGC\",\"android-app_installation_disable-apk-install.md\":\"DwHyjsly\",\"android-app_installation_index.md\":\"DDgvpR6t\",\"android-app_invisible-features_accessibility-helpers.md\":\"CyYfJEWg\",\"android-app_invisible-features_app-state-sync.md\":\"B5h5Ak9W\",\"android-app_invisible-features_config-sync.md\":\"CZBbNP5r\",\"android-app_invisible-features_identity-admin.md\":\"Cf4I2s5R\",\"android-app_invisible-features_index.md\":\"Dgdw7cqW\",\"android-app_invisible-features_lifecycle-session.md\":\"CIOEEiw7\",\"android-app_invisible-features_network-vpn-internals.md\":\"8jPpVLyS\",\"android-app_invisible-features_remote-control-reporting.md\":\"thtZ4mR6\",\"android-app_invisible-features_security-integrity.md\":\"CPO1dAxi\",\"android-app_invisible-features_updates-notifications.md\":\"BZUoCDzA\",\"android-app_network_block-all-traffic.md\":\"U4QtnBYS\",\"android-app_network_block-wi-fi.md\":\"BtiQpQ5G\",\"android-app_network_disable-tethering-and-hotspot.md\":\"CwVB_lCQ\",\"android-app_network_enable-private-dns.md\":\"zo-WCClI\",\"android-app_network_enable-vpn-firewall-regular-vpn-not-vpn2.md\":\"CQiY_VoS\",\"android-app_network_index.md\":\"mVp8qhrE\",\"android-app_network_whitelist-domains-regular-vpn-not-vpn2.md\":\"DofVR53T\",\"android-app_onboarding_device-binding.md\":\"CTQA60FN\",\"android-app_onboarding_index.md\":\"jIkUWIII\",\"android-app_onboarding_mdm-pin-gate.md\":\"B-IAe9D6\",\"android-app_onboarding_onboarding-overview.md\":\"CCVuMXnk\",\"android-app_onboarding_password-reset.md\":\"AaF503hw\",\"android-app_onboarding_permissions-check.md\":\"BKMH23Mi\",\"android-app_onboarding_pin-recovery.md\":\"DYsz54uV\",\"android-app_onboarding_sign-in.md\":\"D2H-59z4\",\"android-app_onboarding_sign-up.md\":\"k4yiEoGz\",\"android-app_onboarding_verify-email.md\":\"BYkWuxro\",\"android-app_onboarding_welcome-terms.md\":\"BJTfsrcC\",\"android-app_settings_account-info.md\":\"Bst34ZFT\",\"android-app_settings_app-density.md\":\"C1gYGgWX\",\"android-app_settings_check-for-app-updates.md\":\"B_iSYaOb\",\"android-app_settings_delete-my-account.md\":\"DfeUUkMQ\",\"android-app_settings_export-profile.md\":\"DYC0U2oz\",\"android-app_settings_import-profile.md\":\"DILbrub9\",\"android-app_settings_import-whitelist.md\":\"DgH-fu0_\",\"android-app_settings_index.md\":\"X_89NHrt\",\"android-app_settings_muted-updates.md\":\"CklRkxMF\",\"android-app_settings_privacy-policy.md\":\"C5IGRwIi\",\"android-app_settings_reset-mdm-pin.md\":\"tlFn_aL3\",\"android-app_settings_support-us.md\":\"ner4hJMy\",\"android-app_settings_switch-to-hebrew.md\":\"DBz-RsTa\",\"android-app_settings_uninstall.md\":\"S9pjrqo0\",\"android-app_system_block-developer-options.md\":\"CWsTA6Gm\",\"android-app_system_block-phone-calls.md\":\"BnrvPKwN\",\"android-app_system_disable-app-settings-control.md\":\"DQ2AaKj2\",\"android-app_system_disable-factory-reset.md\":\"IrbP003D\",\"android-app_system_disable-sms-mms.md\":\"BaiJIEwv\",\"android-app_system_disallow-adding-users.md\":\"mmglRJG5\",\"android-app_system_index.md\":\"C36KpQdN\",\"android-app_updates_aurora-updater.md\":\"CEf3OkKq\",\"android-app_updates_index.md\":\"XqKAX7Ls\",\"directus.md\":\"C2RwsJFh\",\"firestore-config.md\":\"CIbSw3PD\",\"index.md\":\"C02Lv-bH\",\"vpn-wireguard.md\":\"BcYlUgyT\",\"website.md\":\"BVA5BdvV\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"TripleUMDM Docs\",\"description\":\"Internal system docs\",\"base\":\"/docs/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"nav\":[{\"text\":\"Home\",\"link\":\"/\"},{\"text\":\"Android MDM app\",\"link\":\"/android-app/\"},{\"text\":\"Website TS\",\"link\":\"/website\"},{\"text\":\"Firestore config DB\",\"link\":\"/firestore-config\"},{\"text\":\"VPN + MITM proxy\",\"link\":\"/vpn-wireguard\"},{\"text\":\"Directus DB\",\"link\":\"/directus\"}],\"sidebar\":{\"/android-app/\":[{\"text\":\"Overview\",\"link\":\"/android-app/\"},{\"text\":\"Onboarding\",\"items\":[{\"text\":\"Overview\",\"link\":\"/android-app/onboarding/\"},{\"text\":\"Onboarding overview\",\"link\":\"/android-app/onboarding/onboarding-overview\"},{\"text\":\"Welcome + terms\",\"link\":\"/android-app/onboarding/welcome-terms\"},{\"text\":\"Sign in\",\"link\":\"/android-app/onboarding/sign-in\"},{\"text\":\"Sign up\",\"link\":\"/android-app/onboarding/sign-up\"},{\"text\":\"Verify email\",\"link\":\"/android-app/onboarding/verify-email\"},{\"text\":\"Password reset\",\"link\":\"/android-app/onboarding/password-reset\"},{\"text\":\"Device binding\",\"link\":\"/android-app/onboarding/device-binding\"},{\"text\":\"MDM PIN gate\",\"link\":\"/android-app/onboarding/mdm-pin-gate\"},{\"text\":\"PIN recovery\",\"link\":\"/android-app/onboarding/pin-recovery\"},{\"text\":\"Permissions check\",\"link\":\"/android-app/onboarding/permissions-check\"}]},{\"text\":\"Home tab\",\"items\":[{\"text\":\"Overview\",\"link\":\"/android-app/home/\"},{\"text\":\"Hi\",\"link\":\"/android-app/home/hi\"},{\"text\":\"Policies at a glance\",\"link\":\"/android-app/home/policies-at-a-glance\"},{\"text\":\"Did you know\",\"link\":\"/android-app/home/did-you-know\"},{\"text\":\"Policies applied counter\",\"link\":\"/android-app/home/policies-applied-counter\"},{\"text\":\"Managed apps overview\",\"link\":\"/android-app/home/managed-apps-overview\"},{\"text\":\"Whitelist summary card\",\"link\":\"/android-app/home/whitelist-summary-card\"},{\"text\":\"App update prompt\",\"link\":\"/android-app/home/app-update-prompt\"}]},{\"text\":\"System tab\",\"items\":[{\"text\":\"Overview\",\"link\":\"/android-app/system/\"},{\"text\":\"Disallow adding users\",\"link\":\"/android-app/system/disallow-adding-users\"},{\"text\":\"Disable factory reset\",\"link\":\"/android-app/system/disable-factory-reset\"},{\"text\":\"Block developer options\",\"link\":\"/android-app/system/block-developer-options\"},{\"text\":\"Disable app settings control\",\"link\":\"/android-app/system/disable-app-settings-control\"},{\"text\":\"Block phone calls\",\"link\":\"/android-app/system/block-phone-calls\"},{\"text\":\"Disable SMS/MMS\",\"link\":\"/android-app/system/disable-sms-mms\"}]},{\"text\":\"Installation\",\"items\":[{\"text\":\"Overview\",\"link\":\"/android-app/installation/\"},{\"text\":\"Disable APK install\",\"link\":\"/android-app/installation/disable-apk-install\"},{\"text\":\"Block new apps\",\"link\":\"/android-app/installation/block-new-apps\"},{\"text\":\"Allow user updates\",\"link\":\"/android-app/installation/allow-user-updates\"},{\"text\":\"Block Play Store\",\"link\":\"/android-app/installation/block-play-store\"}]},{\"text\":\"Accessibility\",\"items\":[{\"text\":\"Overview\",\"link\":\"/android-app/accessibility/\"},{\"text\":\"Android Auto quirk\",\"link\":\"/android-app/accessibility/android-auto-quirk\"},{\"text\":\"Block WhatsApp updates tab\",\"link\":\"/android-app/accessibility/block-whatsapp-updates-tab\"},{\"text\":\"Block WhatsApp channels\",\"link\":\"/android-app/accessibility/block-whatsapp-channels\"},{\"text\":\"Block status\",\"link\":\"/android-app/accessibility/block-status\"},{\"text\":\"Block AI chats\",\"link\":\"/android-app/accessibility/block-ai-chats\"},{\"text\":\"Block all in-app browsers\",\"link\":\"/android-app/accessibility/block-all-in-app-browsers\"},{\"text\":\"Block default browsers\",\"link\":\"/android-app/accessibility/block-default-browsers\"}]},{\"text\":\"Network tab\",\"items\":[{\"text\":\"Overview\",\"link\":\"/android-app/network/\"},{\"text\":\"Disable tethering and hotspot\",\"link\":\"/android-app/network/disable-tethering-and-hotspot\"},{\"text\":\"Block Wi-Fi\",\"link\":\"/android-app/network/block-wi-fi\"},{\"text\":\"Block all traffic\",\"link\":\"/android-app/network/block-all-traffic\"},{\"text\":\"Enable private DNS\",\"link\":\"/android-app/network/enable-private-dns\"},{\"text\":\"Enable VPN firewall (regular VPN, not VPN2)\",\"link\":\"/android-app/network/enable-vpn-firewall-regular-vpn-not-vpn2\"},{\"text\":\"Whitelist domains (regular VPN, not VPN2)\",\"link\":\"/android-app/network/whitelist-domains-regular-vpn-not-vpn2\"}]},{\"text\":\"Updates tab\",\"items\":[{\"text\":\"Overview\",\"link\":\"/android-app/updates/\"},{\"text\":\"Aurora updater\",\"link\":\"/android-app/updates/aurora-updater\"}]},{\"text\":\"Apps tab\",\"items\":[{\"text\":\"Overview\",\"link\":\"/android-app/apps/\"},{\"text\":\"Users apps\",\"link\":\"/android-app/apps/users-apps\"},{\"text\":\"System apps\",\"link\":\"/android-app/apps/system-apps\"},{\"text\":\"Managed apps\",\"link\":\"/android-app/apps/managed-apps\"},{\"text\":\"Hide\",\"link\":\"/android-app/apps/hide\"},{\"text\":\"Make offline\",\"link\":\"/android-app/apps/make-offline\"},{\"text\":\"Make suspended\",\"link\":\"/android-app/apps/make-suspended\"},{\"text\":\"Disable\",\"link\":\"/android-app/apps/disable\"},{\"text\":\"Block video\",\"link\":\"/android-app/apps/block-video\"},{\"text\":\"Block in-app browser\",\"link\":\"/android-app/apps/block-in-app-browser\"},{\"text\":\"Block uninstall\",\"link\":\"/android-app/apps/block-uninstall\"},{\"text\":\"Add WebView exception\",\"link\":\"/android-app/apps/add-webview-exception\"}]},{\"text\":\"Settings tab\",\"items\":[{\"text\":\"Overview\",\"link\":\"/android-app/settings/\"},{\"text\":\"Switch to Hebrew\",\"link\":\"/android-app/settings/switch-to-hebrew\"},{\"text\":\"Export profile\",\"link\":\"/android-app/settings/export-profile\"},{\"text\":\"Import profile\",\"link\":\"/android-app/settings/import-profile\"},{\"text\":\"Import whitelist\",\"link\":\"/android-app/settings/import-whitelist\"},{\"text\":\"Account info\",\"link\":\"/android-app/settings/account-info\"},{\"text\":\"Privacy policy\",\"link\":\"/android-app/settings/privacy-policy\"},{\"text\":\"Check for app updates\",\"link\":\"/android-app/settings/check-for-app-updates\"},{\"text\":\"Support us\",\"link\":\"/android-app/settings/support-us\"},{\"text\":\"App density\",\"link\":\"/android-app/settings/app-density\"},{\"text\":\"Muted updates\",\"link\":\"/android-app/settings/muted-updates\"},{\"text\":\"Reset MDM PIN\",\"link\":\"/android-app/settings/reset-mdm-pin\"},{\"text\":\"Uninstall\",\"link\":\"/android-app/settings/uninstall\"},{\"text\":\"Delete my account\",\"link\":\"/android-app/settings/delete-my-account\"}]},{\"text\":\"Invisible features\",\"items\":[{\"text\":\"Overview\",\"link\":\"/android-app/invisible-features/\"},{\"text\":\"Lifecycle + session\",\"link\":\"/android-app/invisible-features/lifecycle-session\"},{\"text\":\"Identity + admin\",\"link\":\"/android-app/invisible-features/identity-admin\"},{\"text\":\"Config + sync\",\"link\":\"/android-app/invisible-features/config-sync\"},{\"text\":\"App state sync\",\"link\":\"/android-app/invisible-features/app-state-sync\"},{\"text\":\"Network + VPN internals\",\"link\":\"/android-app/invisible-features/network-vpn-internals\"},{\"text\":\"Accessibility helpers\",\"link\":\"/android-app/invisible-features/accessibility-helpers\"},{\"text\":\"Remote control + reporting\",\"link\":\"/android-app/invisible-features/remote-control-reporting\"},{\"text\":\"Updates + notifications\",\"link\":\"/android-app/invisible-features/updates-notifications\"},{\"text\":\"Security + integrity\",\"link\":\"/android-app/invisible-features/security-integrity\"}]}],\"/\":[{\"text\":\"Home\",\"link\":\"/\"},{\"text\":\"Android app\",\"link\":\"/android-app/\"},{\"text\":\"Website\",\"link\":\"/website\"},{\"text\":\"Firestore config\",\"link\":\"/firestore-config\"},{\"text\":\"VPN + MITM proxy\",\"link\":\"/vpn-wireguard\"},{\"text\":\"Directus\",\"link\":\"/directus\"}]}},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false}");</script>
    
  </body>
</html>