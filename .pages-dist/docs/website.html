<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Website | TripleUMDM Docs</title>
    <meta name="description" content="Internal system docs">
    <meta name="generator" content="VitePress v1.6.4">
    <link rel="preload stylesheet" href="/docs/assets/style.DuOwLuGy.css" as="style">
    <link rel="preload stylesheet" href="/docs/vp-icons.css" as="style">
    
    <script type="module" src="/docs/assets/app.o-vSBVwn.js"></script>
    <link rel="preload" href="/docs/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/docs/assets/chunks/theme.zyXmtp-E.js">
    <link rel="modulepreload" href="/docs/assets/chunks/framework.Cqi9LMMK.js">
    <link rel="modulepreload" href="/docs/assets/website.md.BVA5BdvV.lean.js">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-5d98c3a5><!--[--><!--]--><!--[--><span tabindex="-1" data-v-0b0ada53></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-0b0ada53>Skip to content</a><!--]--><!----><header class="VPNav" data-v-5d98c3a5 data-v-ae24b3ad><div class="VPNavBar" data-v-ae24b3ad data-v-6aa21345><div class="wrapper" data-v-6aa21345><div class="container" data-v-6aa21345><div class="title" data-v-6aa21345><div class="VPNavBarTitle has-sidebar" data-v-6aa21345 data-v-1168a8e4><a class="title" href="/docs/" data-v-1168a8e4><!--[--><!--]--><!----><span data-v-1168a8e4>TripleUMDM Docs</span><!--[--><!--]--></a></div></div><div class="content" data-v-6aa21345><div class="content-body" data-v-6aa21345><!--[--><!--]--><div class="VPNavBarSearch search" data-v-6aa21345><!----></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-6aa21345 data-v-dc692963><span id="main-nav-aria-label" class="visually-hidden" data-v-dc692963> Main Navigation </span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/docs/" tabindex="0" data-v-dc692963 data-v-e56f3d57><!--[--><span data-v-e56f3d57>Home</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/docs/android-app/" tabindex="0" data-v-dc692963 data-v-e56f3d57><!--[--><span data-v-e56f3d57>Android MDM app</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink active" href="/docs/website.html" tabindex="0" data-v-dc692963 data-v-e56f3d57><!--[--><span data-v-e56f3d57>Website TS</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/docs/firestore-config.html" tabindex="0" data-v-dc692963 data-v-e56f3d57><!--[--><span data-v-e56f3d57>Firestore config DB</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/docs/vpn-wireguard.html" tabindex="0" data-v-dc692963 data-v-e56f3d57><!--[--><span data-v-e56f3d57>VPN + MITM proxy</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/docs/directus.html" tabindex="0" data-v-dc692963 data-v-e56f3d57><!--[--><span data-v-e56f3d57>Directus DB</span><!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-6aa21345 data-v-6c893767><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-6c893767 data-v-5337faa4 data-v-1d5665e3><span class="check" data-v-1d5665e3><span class="icon" data-v-1d5665e3><!--[--><span class="vpi-sun sun" data-v-5337faa4></span><span class="vpi-moon moon" data-v-5337faa4></span><!--]--></span></span></button></div><!----><div class="VPFlyout VPNavBarExtra extra" data-v-6aa21345 data-v-bb2aa2f0 data-v-cf11d7a2><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-cf11d7a2><span class="vpi-more-horizontal icon" data-v-cf11d7a2></span></button><div class="menu" data-v-cf11d7a2><div class="VPMenu" data-v-cf11d7a2 data-v-b98bc113><!----><!--[--><!--[--><!----><div class="group" data-v-bb2aa2f0><div class="item appearance" data-v-bb2aa2f0><p class="label" data-v-bb2aa2f0>Appearance</p><div class="appearance-action" data-v-bb2aa2f0><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-bb2aa2f0 data-v-5337faa4 data-v-1d5665e3><span class="check" data-v-1d5665e3><span class="icon" data-v-1d5665e3><!--[--><span class="vpi-sun sun" data-v-5337faa4></span><span class="vpi-moon moon" data-v-5337faa4></span><!--]--></span></span></button></div></div></div><!----><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-6aa21345 data-v-e5dd9c1c><span class="container" data-v-e5dd9c1c><span class="top" data-v-e5dd9c1c></span><span class="middle" data-v-e5dd9c1c></span><span class="bottom" data-v-e5dd9c1c></span></span></button></div></div></div></div><div class="divider" data-v-6aa21345><div class="divider-line" data-v-6aa21345></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-5d98c3a5 data-v-a6f0e41e><div class="container" data-v-a6f0e41e><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-a6f0e41e><span class="vpi-align-left menu-icon" data-v-a6f0e41e></span><span class="menu-text" data-v-a6f0e41e>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-a6f0e41e data-v-8a42e2b4><button data-v-8a42e2b4>Return to top</button><!----></div></div></div><aside class="VPSidebar" data-v-5d98c3a5 data-v-319d5ca6><div class="curtain" data-v-319d5ca6></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-319d5ca6><span class="visually-hidden" id="sidebar-aria-label" data-v-319d5ca6> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0 has-active" data-v-c40bc020 data-v-b3fd67f8><!----><div class="items" data-v-b3fd67f8><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/docs/" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Home</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/docs/android-app/" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Android app</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/docs/website.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Website</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/docs/firestore-config.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Firestore config</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/docs/vpn-wireguard.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>VPN + MITM proxy</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/docs/directus.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Directus</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-5d98c3a5 data-v-1428d186><div class="VPDoc has-sidebar has-aside" data-v-1428d186 data-v-39a288b8><!--[--><!--]--><div class="container" data-v-39a288b8><div class="aside" data-v-39a288b8><div class="aside-curtain" data-v-39a288b8></div><div class="aside-container" data-v-39a288b8><div class="aside-content" data-v-39a288b8><div class="VPDocAside" data-v-39a288b8 data-v-3f215769><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-3f215769 data-v-a5bbad30><div class="content" data-v-a5bbad30><div class="outline-marker" data-v-a5bbad30></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-a5bbad30>On this page</div><ul class="VPDocOutlineItem root" data-v-a5bbad30 data-v-b933a997><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-3f215769></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-39a288b8><div class="content-container" data-v-39a288b8><!--[--><!--]--><main class="main" data-v-39a288b8><div style="position:relative;" class="vp-doc _docs_website" data-v-39a288b8><div><h1 id="website" tabindex="-1">Website <a class="header-anchor" href="#website" aria-label="Permalink to &quot;Website&quot;">​</a></h1><h2 id="overview" tabindex="-1">Overview <a class="header-anchor" href="#overview" aria-label="Permalink to &quot;Overview&quot;">​</a></h2><ul><li>Next.js App Router.</li><li>Main entry: <code>app/page.tsx</code> -&gt; <code>app/components/dashboard/DashboardPage.tsx</code>.</li><li>Login route: <code>app/login/page.tsx</code>.</li><li>All data calls are client-side (Firestore/Cloud Run) with Directus routed through Firebase Functions.</li></ul><h2 id="connections" tabindex="-1">Connections <a class="header-anchor" href="#connections" aria-label="Permalink to &quot;Connections&quot;">​</a></h2><ul><li>Android app applies config/app policies written here; see <code>android-app</code>.</li><li>Full path map + backend details: <code>firestore-config</code>.</li><li>VPN + MITM server stack: <code>vpn-wireguard</code>.</li><li>Directus schema + ops: <code>directus</code>.</li></ul><h2 id="request-map-website-backend" tabindex="-1">Request map (website -&gt; backend) <a class="header-anchor" href="#request-map-website-backend" aria-label="Permalink to &quot;Request map (website -&gt; backend)&quot;">​</a></h2><ul><li>Firebase Auth: login, session guard, sign out, password reset.</li><li>Firestore: devices list, config state, apps, commands, notes, remote session.</li><li>Cloud Run: device slot checkout and VPN checkout (ID token in Authorization header).</li><li>Directus (via Firebase Functions): VPN categories, appeals, category prefs, site overrides.</li><li>WebRTC: STUN/TURN for Remote Control (TURN host on <code>kvylock</code>; see <code>vpn-wireguard</code>).</li></ul><h2 id="auth-access" tabindex="-1">Auth + access <a class="header-anchor" href="#auth-access" aria-label="Permalink to &quot;Auth + access&quot;">​</a></h2><ul><li>Login uses Firebase Auth email + password.</li><li>Optional Cloudflare Turnstile if <code>NEXT_PUBLIC_CF_TURNSTILE_SITEKEY</code> is set.</li><li>Turnstile token is checked client-side only.</li><li>Login validates email format and password length (&gt;= 6).</li><li>Wrong-password/user-not-found/invalid-credential errors display &quot;Wrong PIN.&quot;</li><li>Dashboard redirects to <code>/login</code> when <code>onAuthStateChanged</code> reports no user.</li><li>Sign out calls <code>signOut(auth)</code> and redirects to <code>/login</code>.</li></ul><h2 id="login-page" tabindex="-1">Login page <a class="header-anchor" href="#login-page" aria-label="Permalink to &quot;Login page&quot;">​</a></h2><h3 id="where-it-lives" tabindex="-1">Where it lives <a class="header-anchor" href="#where-it-lives" aria-label="Permalink to &quot;Where it lives&quot;">​</a></h3><ul><li><code>app/login/page.tsx</code></li></ul><h3 id="ui" tabindex="-1">UI <a class="header-anchor" href="#ui" aria-label="Permalink to &quot;UI&quot;">​</a></h3><ul><li>Email + password fields.</li><li>&quot;Continue&quot; sign-in button.</li><li>&quot;Reset password&quot; button.</li><li>Optional Turnstile widget.</li></ul><h3 id="calls" tabindex="-1">Calls <a class="header-anchor" href="#calls" aria-label="Permalink to &quot;Calls&quot;">​</a></h3><ul><li><code>signInWithEmailAndPassword(auth, email, password)</code>.</li><li><code>sendPasswordResetEmail(auth, email)</code>.</li></ul><h2 id="layout-navigation" tabindex="-1">Layout + navigation <a class="header-anchor" href="#layout-navigation" aria-label="Permalink to &quot;Layout + navigation&quot;">​</a></h2><ul><li>Header: <code>app/components/dashboard/HeaderBar.tsx</code>. <ul><li>Device picker, Add device, Support, Contact, account menu (email + Sign out).</li></ul></li><li>Left nav: <code>app/components/dashboard/NavigationPanel.tsx</code>. <ul><li>Tabs come from <code>app/components/dashboard/constants.ts</code> (<code>deviceTabs</code>).</li></ul></li><li>Save/Discard bar appears when config/app/device name/VPN category/blocklist changes exist.</li><li>Support opens <code>https://tripleu.org</code>.</li><li>Contact opens <code>mailto:tripleuworld@gmail.com</code>.</li></ul><h2 id="global-ui-behavior" tabindex="-1">Global UI behavior <a class="header-anchor" href="#global-ui-behavior" aria-label="Permalink to &quot;Global UI behavior&quot;">​</a></h2><ul><li>Tabs are local state only (no URL per tab).</li><li>Loading bar appears while auth/devices/config/apps/notes are loading.</li><li>Toasts show bottom-center and auto-hide after ~4 seconds.</li><li>Destructive actions use a confirm dialog (wipe/uninstall).</li></ul><h2 id="device-list-selection-global" tabindex="-1">Device list + selection (global) <a class="header-anchor" href="#device-list-selection-global" aria-label="Permalink to &quot;Device list + selection (global)&quot;">​</a></h2><h3 id="where-it-lives-1" tabindex="-1">Where it lives <a class="header-anchor" href="#where-it-lives-1" aria-label="Permalink to &quot;Where it lives&quot;">​</a></h3><ul><li><code>app/components/dashboard/DashboardPage.tsx</code></li></ul><h3 id="how-it-fetches" tabindex="-1">How it fetches <a class="header-anchor" href="#how-it-fetches" aria-label="Permalink to &quot;How it fetches&quot;">​</a></h3><ul><li>Reads Firestore <code>devices</code> where <code>ownerUid == currentUser.uid</code>.</li><li>If empty and <code>user.email</code> exists, falls back to <code>ownerEmail == user.email</code>.</li><li>Limits to 25 devices.</li><li>Restores the last selected device from <code>localStorage</code> (<code>mdm.last_device.&lt;uid&gt;</code>).</li><li>Falls back to the first device when no stored match exists.</li></ul><h3 id="device-metadata" tabindex="-1">Device metadata <a class="header-anchor" href="#device-metadata" aria-label="Permalink to &quot;Device metadata&quot;">​</a></h3><ul><li>Reads <code>devices/{deviceId}</code> to build the header and status chips.</li><li><code>deviceName</code> edits are saved on &quot;Save&quot; (same commit as config/app changes).</li><li>Label order: <code>deviceName</code> -&gt; <code>displayName</code> -&gt; <code>deviceInfo.model</code> -&gt; <code>deviceId</code> -&gt; doc id.</li></ul><h2 id="config-save-flow-web" tabindex="-1">Config + save flow (web) <a class="header-anchor" href="#config-save-flow-web" aria-label="Permalink to &quot;Config + save flow (web)&quot;">​</a></h2><h3 id="how-it-loads" tabindex="-1">How it loads <a class="header-anchor" href="#how-it-loads" aria-label="Permalink to &quot;How it loads&quot;">​</a></h3><ul><li>Reads <code>devices/{deviceId}/config/state/current/current</code>.</li><li>Merges <code>entries[]</code> into <code>defaultDeviceConfig</code>.</li><li>Missing config -&gt; uses defaults.</li><li>Ignores entries whose keys are not in <code>defaultDeviceConfig</code>.</li></ul><h3 id="how-it-saves" tabindex="-1">How it saves <a class="header-anchor" href="#how-it-saves" aria-label="Permalink to &quot;How it saves&quot;">​</a></h3><ul><li>Saves device name to <code>devices/{deviceId}</code> when changed.</li><li>Writes config <code>entries[]</code> back with <code>source=admin</code> and <code>updatedAtMs</code> (all keys).</li><li>Preserves existing entries for unknown keys.</li><li>Writes app changes in a Firestore batch.</li><li>Saves VPN category changes (Functions) after Firestore writes.</li></ul><h3 id="discard" tabindex="-1">Discard <a class="header-anchor" href="#discard" aria-label="Permalink to &quot;Discard&quot;">​</a></h3><ul><li>Resets pending config/app changes, VPN category edits, and inputs.</li><li>Increments <code>refreshTick</code> to refetch apps and notes.</li></ul><h2 id="firestore-data-model-fields-used-by-ui" tabindex="-1">Firestore data model (fields used by UI) <a class="header-anchor" href="#firestore-data-model-fields-used-by-ui" aria-label="Permalink to &quot;Firestore data model (fields used by UI)&quot;">​</a></h2><h3 id="device-docs-devices-deviceid" tabindex="-1">Device docs (<code>devices/{deviceId}</code>) <a class="header-anchor" href="#device-docs-devices-deviceid" aria-label="Permalink to &quot;Device docs (`devices/{deviceId}`)&quot;">​</a></h3><ul><li><code>ownerUid</code>, <code>ownerEmail</code>.</li><li><code>deviceName</code> / <code>displayName</code>.</li><li><code>status</code>.</li><li><code>lastSeenMs</code> or <code>lastSeen</code>.</li><li><code>deviceInfo</code> (model, release/sdk, versionName, brand/manufacturer).</li><li><code>vpn</code> (premium status): <code>active</code>, <code>stripeSubscriptionId</code>, <code>expiresAtMs</code>.</li></ul><h3 id="config-doc-devices-deviceid-config-state-current-current" tabindex="-1">Config doc (<code>devices/{deviceId}/config/state/current/current</code>) <a class="header-anchor" href="#config-doc-devices-deviceid-config-state-current-current" aria-label="Permalink to &quot;Config doc (`devices/{deviceId}/config/state/current/current`)&quot;">​</a></h3><ul><li><code>entries[]</code>: <code>{ key, value, type, updatedAtMs, source }</code>.</li><li>Meta: <code>cloudUpdated</code>, <code>cloudUpdatedTime</code>, <code>deviceUpdated</code>, <code>deviceUpdatedTime</code>, <code>updatedAtMs</code>, <code>lastSeenMs</code>, <code>status</code>.</li><li>UI writes <code>entries</code> and sets <code>cloudUpdated=true</code> + <code>cloudUpdatedTime</code> on Save.</li><li>Parsing rules in UI: <ul><li><code>settings.app_density_percent</code> -&gt; int.</li><li><code>settings.language</code>, <code>network.private_dns_hostname</code>, <code>auth.pin_sha256</code> -&gt; string.</li><li><code>network.domain_whitelist_hosts</code>, <code>updates.muted_packages</code> -&gt; JSON string arrays.</li><li>Other keys -&gt; boolean.</li></ul></li><li>On Save, <code>type</code> is <code>json</code> for whitelist/muted packages, <code>int</code> for density, <code>string</code> for text keys, <code>bool</code> for everything else.</li></ul><h3 id="apps-devices-deviceid-apps" tabindex="-1">Apps (<code>devices/{deviceId}/apps</code>) <a class="header-anchor" href="#apps-devices-deviceid-apps" aria-label="Permalink to &quot;Apps (`devices/{deviceId}/apps`)&quot;">​</a></h3><ul><li><code>label</code>, <code>versionName</code>, <code>system</code>, <code>managed</code>.</li><li>Policy flags: <code>approved</code>, <code>hidden</code>, <code>suspended</code>, <code>uninstallBlocked</code>, <code>networkBlocked</code>, <code>webviewBlocked</code>, <code>webviewException</code>, <code>videoBlocked</code>.</li><li><code>updatedAtMs</code>, <code>icon</code> (base64).</li><li>App cards fall back to <code>https://play-lh.googleusercontent.com/&lt;package&gt;</code> when no icon.</li></ul><h3 id="notes-devices-deviceid-notes" tabindex="-1">Notes (<code>devices/{deviceId}/notes</code>) <a class="header-anchor" href="#notes-devices-deviceid-notes" aria-label="Permalink to &quot;Notes (`devices/{deviceId}/notes`)&quot;">​</a></h3><ul><li><code>text</code>, <code>createdAt</code>.</li></ul><h3 id="commands-devices-deviceid-commands" tabindex="-1">Commands (<code>devices/{deviceId}/commands</code>) <a class="header-anchor" href="#commands-devices-deviceid-commands" aria-label="Permalink to &quot;Commands (`devices/{deviceId}/commands`)&quot;">​</a></h3><ul><li>Types used: <code>inventory</code>, <code>wipe</code>, <code>uninstall</code>, <code>start_remote</code>, <code>stop_remote</code>.</li></ul><h2 id="home-tab" tabindex="-1">Home tab <a class="header-anchor" href="#home-tab" aria-label="Permalink to &quot;Home tab&quot;">​</a></h2><h3 id="where-it-lives-2" tabindex="-1">Where it lives <a class="header-anchor" href="#where-it-lives-2" aria-label="Permalink to &quot;Where it lives&quot;">​</a></h3><ul><li><code>app/components/dashboard/DashboardPage.tsx</code></li><li><code>app/components/dashboard/constants.ts</code> (did-you-know tips)</li></ul><h3 id="what-it-shows" tabindex="-1">What it shows <a class="header-anchor" href="#what-it-shows" aria-label="Permalink to &quot;What it shows&quot;">​</a></h3><ul><li>Device header (name, status, OS, app version, brand, owner email, last seen).</li><li>Summary cards: Sync (cloud/device update times), Policies, Device state, Apps.</li><li>App policy summary chips.</li><li>&quot;Did you know?&quot; single tip (random on first load).</li><li>Key restrictions list (up to 10 active policy keys).</li><li>Notes list with add/delete and relative timestamps.</li><li>Inline device name edit (Esc cancels, Enter/blur ends edit; Save persists).</li></ul><h3 id="data-sources" tabindex="-1">Data sources <a class="header-anchor" href="#data-sources" aria-label="Permalink to &quot;Data sources&quot;">​</a></h3><ul><li><code>devices/{deviceId}</code>: status, owner email, deviceInfo, deviceName.</li><li><code>devices/{deviceId}/config/state/current/current</code>: config entries + timestamps.</li><li><code>devices/{deviceId}/apps</code>: app flags for counts and policy summary.</li><li><code>devices/{deviceId}/notes</code>: note text + timestamps.</li></ul><h3 id="calls-1" tabindex="-1">Calls <a class="header-anchor" href="#calls-1" aria-label="Permalink to &quot;Calls&quot;">​</a></h3><ul><li><code>getDocs(collection(db, &quot;devices&quot;))</code> for device list.</li><li><code>getDoc(doc(db, &quot;devices&quot;, deviceId))</code> for device metadata.</li><li><code>getDoc(doc(db, &quot;devices&quot;, deviceId, &quot;config&quot;, &quot;state&quot;, &quot;current&quot;, &quot;current&quot;))</code> for config summary.</li><li><code>getDocs(collection(db, &quot;devices&quot;, deviceId, &quot;apps&quot;))</code> for app counts.</li><li><code>addDoc</code> / <code>deleteDoc</code> in <code>devices/{deviceId}/notes</code> for notes.</li><li>Notes query uses <code>orderBy(&quot;createdAt&quot;, &quot;desc&quot;)</code> + <code>limit(50)</code>.</li></ul><h2 id="system-tab" tabindex="-1">System tab <a class="header-anchor" href="#system-tab" aria-label="Permalink to &quot;System tab&quot;">​</a></h2><h3 id="where-it-lives-3" tabindex="-1">Where it lives <a class="header-anchor" href="#where-it-lives-3" aria-label="Permalink to &quot;Where it lives&quot;">​</a></h3><ul><li><code>app/components/dashboard/DashboardPage.tsx</code></li><li><code>app/components/dashboard/constants.ts</code></li></ul><h3 id="ui-1" tabindex="-1">UI <a class="header-anchor" href="#ui-1" aria-label="Permalink to &quot;UI&quot;">​</a></h3><ul><li>Remote Lockout Mode.</li><li>Block Add Users.</li><li>Block Factory Reset.</li><li>Block Developer Options.</li><li>Block Apps Control.</li><li>Block Phone Calls.</li><li>Block SMS.</li></ul><h3 id="config-keys-written" tabindex="-1">Config keys written <a class="header-anchor" href="#config-keys-written" aria-label="Permalink to &quot;Config keys written&quot;">​</a></h3><ul><li><code>system.lockout_enabled</code></li><li><code>system.add_users_blocked</code></li><li><code>system.factory_reset_blocked</code></li><li><code>system.developer_options_blocked</code></li><li><code>system.apps_control_blocked</code></li><li><code>system.calls_blocked</code></li><li><code>system.sms_blocked</code></li></ul><h3 id="how-it-writes" tabindex="-1">How it writes <a class="header-anchor" href="#how-it-writes" aria-label="Permalink to &quot;How it writes&quot;">​</a></h3><ul><li>Switches update <code>pendingConfig</code>.</li><li>&quot;Save&quot; writes to <code>devices/{deviceId}/config/state/current/current</code> as <code>entries[]</code> with <code>source=admin</code> and <code>updatedAtMs</code>.</li></ul><h3 id="calls-2" tabindex="-1">Calls <a class="header-anchor" href="#calls-2" aria-label="Permalink to &quot;Calls&quot;">​</a></h3><ul><li>No extra reads besides the shared config load.</li><li>Uses <code>setDoc</code> to persist config entries on save.</li></ul><h2 id="installation-tab" tabindex="-1">Installation tab <a class="header-anchor" href="#installation-tab" aria-label="Permalink to &quot;Installation tab&quot;">​</a></h2><h3 id="where-it-lives-4" tabindex="-1">Where it lives <a class="header-anchor" href="#where-it-lives-4" aria-label="Permalink to &quot;Where it lives&quot;">​</a></h3><ul><li><code>app/components/dashboard/DashboardPage.tsx</code></li><li><code>app/components/dashboard/constants.ts</code></li></ul><h3 id="ui-2" tabindex="-1">UI <a class="header-anchor" href="#ui-2" aria-label="Permalink to &quot;UI&quot;">​</a></h3><ul><li>Block APK installs.</li><li>Block new apps.</li><li>Block Play Store.</li><li>Allow user updates.</li><li>App Detection Console (Pending / Approved lists).</li><li>Legacy app lists (raw JSON).</li></ul><h3 id="config-keys-written-1" tabindex="-1">Config keys written <a class="header-anchor" href="#config-keys-written-1" aria-label="Permalink to &quot;Config keys written&quot;">​</a></h3><ul><li><code>system.apk_install_blocked</code></li><li><code>apps.block_new_apps</code></li><li><code>system.play_store_blocked</code></li><li><code>apps.allow_user_updates</code></li><li><code>apps.approved</code></li><li><code>apps.known_installed</code></li></ul><h3 id="app-approvals-console" tabindex="-1">App approvals (console) <a class="header-anchor" href="#app-approvals-console" aria-label="Permalink to &quot;App approvals (console)&quot;">​</a></h3><ul><li>Data source: <code>devices/{deviceId}/apps</code>.</li><li>Pending list: <ul><li>apps that are currently blocked (<code>hidden</code> or <code>suspended</code>) and not approved.</li></ul></li><li>Approved list: <ul><li>apps where <code>approved === true</code>, or locally approved.</li></ul></li><li>Clicking Approve/Reject only updates local state until Save.</li><li>On Save, each changed app writes: <ul><li><code>approved</code> boolean.</li><li><code>hidden</code> and <code>suspended</code> set to <code>!approved</code>.</li><li><code>updatedAtMs</code> and <code>source=admin</code>.</li></ul></li><li>App policy overrides from the Apps tab are applied after approvals.</li></ul><h3 id="calls-3" tabindex="-1">Calls <a class="header-anchor" href="#calls-3" aria-label="Permalink to &quot;Calls&quot;">​</a></h3><ul><li>Uses the shared config load.</li><li>Uses <code>getDocs</code> on <code>devices/{deviceId}/apps</code> (already loaded for tabs).</li></ul><h2 id="remote-control-tab" tabindex="-1">Remote Control tab <a class="header-anchor" href="#remote-control-tab" aria-label="Permalink to &quot;Remote Control tab&quot;">​</a></h2><h3 id="where-it-lives-5" tabindex="-1">Where it lives <a class="header-anchor" href="#where-it-lives-5" aria-label="Permalink to &quot;Where it lives&quot;">​</a></h3><ul><li><code>app/components/dashboard/DashboardPage.tsx</code></li><li><code>app/components/dashboard/RemoteControl.tsx</code></li></ul><h3 id="ui-3" tabindex="-1">UI <a class="header-anchor" href="#ui-3" aria-label="Permalink to &quot;UI&quot;">​</a></h3><ul><li>Start/Stop session buttons.</li><li>Video stream area with mouse/touch control.</li><li>Nav bar: Back, Home, Recents.</li><li>Optional text input toggle.</li></ul><h3 id="firestore-flow" tabindex="-1">Firestore flow <a class="header-anchor" href="#firestore-flow" aria-label="Permalink to &quot;Firestore flow&quot;">​</a></h3><ul><li>Start: <ul><li>Calls callable <code>remoteStart</code> with <code>deviceId</code>.</li><li>Function writes <code>remote_session/current</code> (status + timestamps), clears <code>ice_candidates</code>, and enqueues <code>start_remote</code>.</li></ul></li><li>Session: <ul><li>Listens to <code>devices/{deviceId}/remote_session/current</code>.</li><li>When <code>status=offering</code>, reads <code>offer</code> and writes <code>answer</code>.</li><li>Ignores stale <code>status=ended</code> events where <code>updatedAtMs</code> is older than the session start.</li></ul></li><li>ICE: <ul><li>Writes to <code>devices/{deviceId}/remote_session/current/remote_candidates</code>.</li><li>Listens to <code>devices/{deviceId}/remote_session/current/ice_candidates</code>.</li></ul></li><li>Stop: <ul><li>Calls callable <code>remoteStop</code> with <code>deviceId</code>.</li><li>Function enqueues <code>stop_remote</code> and marks <code>remote_session/current</code> as ended.</li></ul></li></ul><h3 id="webrtc-input" tabindex="-1">WebRTC + input <a class="header-anchor" href="#webrtc-input" aria-label="Permalink to &quot;WebRTC + input&quot;">​</a></h3><ul><li>PeerConnection uses TURN from callables (<code>remoteStart</code>, fallback <code>remoteStatus</code>): <ul><li><code>turnConfig.urls</code> (array or string), plus optional <code>username</code>/<code>user</code> and <code>credential</code>/<code>password</code>.</li><li>Always includes <code>stun:stun.l.google.com:19302</code> as a fallback.</li></ul></li><li>Data channel messages: <ul><li><code>type: &quot;input&quot;</code> with <code>{ action, x, y }</code> (normalized 0..1).</li><li><code>type: &quot;nav&quot;</code> with <code>{ action: &quot;back&quot; | &quot;home&quot; | &quot;recents&quot; }</code>.</li><li><code>type: &quot;text&quot;</code> with <code>{ text }</code>.</li><li><code>type: &quot;key&quot;</code> with <code>{ key }</code> or <code>{ action: &quot;backspace&quot; | &quot;enter&quot; | &quot;tab&quot; }</code>.</li></ul></li><li>Session stays alive across tab switches; cleanup only on Stop or page unload.</li><li>Input behavior: <ul><li>Click vs drag uses a 2% screen-distance threshold.</li><li>Mouse move events throttle to ~30fps.</li><li>Touch events map to the same <code>input</code> messages.</li><li>Pointer coordinates account for letterboxing (actual video display bounds).</li></ul></li><li>TURN server details: see <code>vpn-wireguard</code>.</li></ul><h2 id="accessibility-tab" tabindex="-1">Accessibility tab <a class="header-anchor" href="#accessibility-tab" aria-label="Permalink to &quot;Accessibility tab&quot;">​</a></h2><h3 id="where-it-lives-6" tabindex="-1">Where it lives <a class="header-anchor" href="#where-it-lives-6" aria-label="Permalink to &quot;Where it lives&quot;">​</a></h3><ul><li><code>app/components/dashboard/DashboardPage.tsx</code></li><li><code>app/components/dashboard/constants.ts</code></li></ul><h3 id="ui-4" tabindex="-1">UI <a class="header-anchor" href="#ui-4" aria-label="Permalink to &quot;UI&quot;">​</a></h3><ul><li>Android Auto quirk.</li><li>Block WhatsApp Updates tab.</li><li>Block WhatsApp Channels.</li><li>Block WhatsApp Status.</li><li>Block In-App AI.</li><li>Block All WebViews.</li><li>Browser Dummy Mode.</li></ul><h3 id="config-keys-written-2" tabindex="-1">Config keys written <a class="header-anchor" href="#config-keys-written-2" aria-label="Permalink to &quot;Config keys written&quot;">​</a></h3><ul><li><code>accessibility.android_auto_quirk</code></li><li><code>accessibility.whatsapp_updates_blocked</code></li><li><code>accessibility.whatsapp_channels_blocked</code></li><li><code>accessibility.whatsapp_status_blocked</code></li><li><code>accessibility.in_app_ai_blocked</code></li><li><code>accessibility.webview_block_all</code></li><li><code>accessibility.browser_dummy_mode</code></li></ul><h3 id="calls-4" tabindex="-1">Calls <a class="header-anchor" href="#calls-4" aria-label="Permalink to &quot;Calls&quot;">​</a></h3><ul><li>Uses the shared config load + save flow.</li></ul><h2 id="network-tab" tabindex="-1">Network tab <a class="header-anchor" href="#network-tab" aria-label="Permalink to &quot;Network tab&quot;">​</a></h2><h3 id="where-it-lives-7" tabindex="-1">Where it lives <a class="header-anchor" href="#where-it-lives-7" aria-label="Permalink to &quot;Where it lives&quot;">​</a></h3><ul><li><code>app/components/dashboard/DashboardPage.tsx</code></li><li><code>app/components/dashboard/constants.ts</code></li></ul><h3 id="ui-5" tabindex="-1">UI <a class="header-anchor" href="#ui-5" aria-label="Permalink to &quot;UI&quot;">​</a></h3><ul><li>Enable VPN (master).</li><li>Block All Traffic (disabled while whitelist is on).</li><li>Block Wi-Fi.</li><li>Block Tethering.</li><li>Domain Whitelist Mode + host list editor.</li><li>Private DNS + hostname (disabled while whitelist is on).</li><li>UI gating: <ul><li>Enable VPN + Block All are disabled when Domain Whitelist is on or Premium VPN is active.</li><li>Domain Whitelist is disabled when Premium VPN is active.</li><li>Private DNS is disabled while Domain Whitelist is on.</li></ul></li></ul><h3 id="config-keys-written-3" tabindex="-1">Config keys written <a class="header-anchor" href="#config-keys-written-3" aria-label="Permalink to &quot;Config keys written&quot;">​</a></h3><ul><li><code>network.vpn_enabled</code></li><li><code>network.block_all_traffic</code></li><li><code>network.wifi_blocked</code></li><li><code>system.tethering_blocked</code></li><li><code>network.domain_whitelist_enabled</code></li><li><code>network.domain_whitelist_hosts</code> (JSON array)</li><li><code>network.private_dns_enabled</code></li><li><code>network.private_dns_hostname</code></li></ul><h3 id="calls-5" tabindex="-1">Calls <a class="header-anchor" href="#calls-5" aria-label="Permalink to &quot;Calls&quot;">​</a></h3><ul><li>Uses the shared config load + save flow.</li></ul><h2 id="vpn-tab-premium" tabindex="-1">VPN tab (premium) <a class="header-anchor" href="#vpn-tab-premium" aria-label="Permalink to &quot;VPN tab (premium)&quot;">​</a></h2><h3 id="where-it-lives-8" tabindex="-1">Where it lives <a class="header-anchor" href="#where-it-lives-8" aria-label="Permalink to &quot;Where it lives&quot;">​</a></h3><ul><li><code>app/components/dashboard/DashboardPage.tsx</code></li><li>Directus calls are server-side via Firebase Functions.</li></ul><h3 id="tab-visibility" tabindex="-1">Tab visibility <a class="header-anchor" href="#tab-visibility" aria-label="Permalink to &quot;Tab visibility&quot;">​</a></h3><ul><li>Always visible.</li></ul><h3 id="premium-access-gate" tabindex="-1">Premium access gate <a class="header-anchor" href="#premium-access-gate" aria-label="Permalink to &quot;Premium access gate&quot;">​</a></h3><ul><li>Uses <code>devices/{deviceId}.vpn</code> and requires: <ul><li><code>active=true</code></li><li><code>stripeSubscriptionId</code> not empty</li><li><code>expiresAtMs</code> in the future</li></ul></li><li>When invalid, premium actions are disabled and panels stay collapsed.</li><li>Subtabs: Blocklists, Website Categories, Appeals (panel is disabled when subscription is invalid).</li></ul><h3 id="premium-vpn-toggle" tabindex="-1">Premium VPN toggle <a class="header-anchor" href="#premium-vpn-toggle" aria-label="Permalink to &quot;Premium VPN toggle&quot;">​</a></h3><ul><li>Writes config key <code>network.premium_vpn_enabled</code>.</li><li>Disabled if the subscription check above fails.</li><li>When active, legacy VPN controls (Network tab) are disabled.</li></ul><h3 id="flow" tabindex="-1">Flow <a class="header-anchor" href="#flow" aria-label="Permalink to &quot;Flow&quot;">​</a></h3><ul><li>Buy VPN -&gt; Cloud Run checkout -&gt; Stripe webhook -&gt; Firebase writes <code>devices/{deviceId}.vpn</code>.</li><li>Android reads the VPN fields and starts WireGuard; server stack is in <code>vpn-wireguard</code>.</li><li>Traffic model: <ul><li>Chrome is forced to use the MITM explicit proxy on the VPN gateway.</li><li>Other apps stay in the WireGuard tunnel and are filtered by Squid blocklists.</li></ul></li><li>Cancel VPN: <ul><li>Button switches to &quot;Cancel subscription&quot; when a valid subscription exists.</li><li>Uses <code>devices/{deviceId}.vpn.cancelAtPeriodEnd</code> to show &quot;Cancel scheduled&quot;.</li></ul></li></ul><h3 id="appeals-blocked-sites" tabindex="-1">Appeals (blocked sites) <a class="header-anchor" href="#appeals-blocked-sites" aria-label="Permalink to &quot;Appeals (blocked sites)&quot;">​</a></h3><ul><li>Reads from Directus <code>vpn_appeals</code> filtered by <code>device_id</code> (via Functions).</li><li>Orders by <code>created_at</code> (desc) and only shows <code>pending</code> or empty status.</li><li>Actions: <ul><li>Allow site -&gt; upsert <code>vpn_site_overrides</code> with <code>enabled_override=force_allow</code>.</li><li>Allow category -&gt; upsert <code>vpn_category_prefs</code> with <code>enabled=true</code>.</li><li>Deny -&gt; updates <code>vpn_appeals.status=denied</code>.</li></ul></li></ul><h3 id="vpn-blocklists" tabindex="-1">VPN blocklists <a class="header-anchor" href="#vpn-blocklists" aria-label="Permalink to &quot;VPN blocklists&quot;">​</a></h3><ul><li>Reads <code>vpn_squid_lists</code> for labels and writes <code>vpn_squid_prefs</code> per device (via Functions).</li><li>Defaults to <code>maps</code>, <code>gifs</code>, <code>adblock</code> if no list metadata exists.</li><li>Hidden keys (e.g. <code>zing</code>) are filtered out of the UI.</li><li><code>general</code> and <code>app_urls</code> are intentionally not shown in the portal.</li><li><code>adblock</code> is sourced from OISD Full on the server.</li><li>Defaults to enabled; disabled lists are stored with <code>enabled=false</code>.</li><li>Also adds Directus collections that have <code>meta.group = &quot;apps&quot;</code> (one toggle per collection). <ul><li>Collection name becomes the key; label comes from the collection name or <code>meta.note</code>.</li></ul></li></ul><h3 id="category-defaults" tabindex="-1">Category defaults <a class="header-anchor" href="#category-defaults" aria-label="Permalink to &quot;Category defaults&quot;">​</a></h3><ul><li>Reads categories from Directus <code>website_categories</code> (via Functions).</li><li>Reads and writes per-device overrides in <code>vpn_category_prefs</code> (via Functions).</li><li>Saves only the fields that differ from defaults.</li><li>Category list rules: <ul><li>Only <code>visibility=public|more</code>.</li><li>Excludes names in <code>EXTREME_CATEGORY_NAMES</code>.</li><li>Sorts by <code>sort_order</code>, then name.</li><li><code>default_image_blocking</code> falls back to <code>default_gif_blocking</code> when present.</li></ul></li><li>Deletes a pref row when a category matches defaults.</li></ul><h3 id="directus-details" tabindex="-1">Directus details <a class="header-anchor" href="#directus-details" aria-label="Permalink to &quot;Directus details&quot;">​</a></h3><ul><li>Schema and server notes: <code>directus</code>.</li></ul><h3 id="payments" tabindex="-1">Payments <a class="header-anchor" href="#payments" aria-label="Permalink to &quot;Payments&quot;">​</a></h3><ul><li>&quot;Buy VPN&quot; calls Cloud Run: <ul><li><code>https://createvpnsubscriptioncheckouthttp-xjmaoa4a5a-uc.a.run.app</code></li><li>Authorization: Firebase ID token in <code>Authorization: Bearer &lt;token&gt;</code>.</li><li>Body: <code>{ deviceId }</code>.</li><li>Redirects to <code>url</code> from the response.</li></ul></li></ul><h2 id="apps-tab" tabindex="-1">Apps tab <a class="header-anchor" href="#apps-tab" aria-label="Permalink to &quot;Apps tab&quot;">​</a></h2><h3 id="where-it-lives-9" tabindex="-1">Where it lives <a class="header-anchor" href="#where-it-lives-9" aria-label="Permalink to &quot;Where it lives&quot;">​</a></h3><ul><li><code>app/components/dashboard/DashboardPage.tsx</code></li><li><code>app/components/dashboard/constants.ts</code></li></ul><h3 id="ui-6" tabindex="-1">UI <a class="header-anchor" href="#ui-6" aria-label="Permalink to &quot;UI&quot;">​</a></h3><ul><li>Search + filter (Managed/User/System/All).</li><li>Inventory refresh button.</li><li>Per-app policy chips: Hide, Suspend, Offline, Block Video, WebView block/exception, Lock Uninstall.</li></ul><h3 id="app-data-source" tabindex="-1">App data source <a class="header-anchor" href="#app-data-source" aria-label="Permalink to &quot;App data source&quot;">​</a></h3><ul><li><code>devices/{deviceId}/apps</code> (base list) plus targeted queries for <code>hidden=true</code> and <code>suspended=true</code>.</li><li>Merges results by package to avoid missing blocked apps.</li></ul><h3 id="app-actions" tabindex="-1">App actions <a class="header-anchor" href="#app-actions" aria-label="Permalink to &quot;App actions&quot;">​</a></h3><ul><li>Inventory refresh sends command: <ul><li><code>devices/{deviceId}/commands</code> with <code>type=inventory</code>.</li></ul></li><li>Per-app changes are staged locally and written on Save.</li><li>Writes per app: <ul><li><code>hidden</code>, <code>suspended</code>, <code>networkBlocked</code>, <code>videoBlocked</code>, <code>webviewBlocked</code>, <code>webviewException</code>, <code>uninstallBlocked</code>.</li><li><code>updatedAtMs</code> and <code>source=admin</code>.</li></ul></li><li>When <code>accessibility.webview_block_all</code> is on: <ul><li>The per-app WebView chip becomes an exception toggle.</li></ul></li><li>Offline (network block) chip is disabled when: <ul><li>Domain Whitelist is enabled, or</li><li>Premium VPN is active.</li></ul></li><li>&quot;Managed&quot; filter is policy-based (hidden/suspended/network/webview/video/uninstall), not the Firestore <code>managed</code> flag.</li><li>Search matches app label or package substring (case-insensitive).</li></ul><h2 id="settings-tab" tabindex="-1">Settings tab <a class="header-anchor" href="#settings-tab" aria-label="Permalink to &quot;Settings tab&quot;">​</a></h2><h3 id="where-it-lives-10" tabindex="-1">Where it lives <a class="header-anchor" href="#where-it-lives-10" aria-label="Permalink to &quot;Where it lives&quot;">​</a></h3><ul><li><code>app/components/dashboard/DashboardPage.tsx</code></li><li><code>app/components/dashboard/utils.ts</code> (SHA-256)</li></ul><h3 id="ui-7" tabindex="-1">UI <a class="header-anchor" href="#ui-7" aria-label="Permalink to &quot;UI&quot;">​</a></h3><ul><li>Language switch (English / Hebrew).</li><li>Display density presets.</li><li>Reset device PIN (hash stored in config).</li><li>Muted app updates list.</li><li>Account actions: Reset password, Factory reset, Uninstall MDM.</li><li>Privacy policy link.</li></ul><h3 id="config-keys-written-4" tabindex="-1">Config keys written <a class="header-anchor" href="#config-keys-written-4" aria-label="Permalink to &quot;Config keys written&quot;">​</a></h3><ul><li><code>settings.language</code></li><li><code>settings.app_density_percent</code></li><li><code>auth.pin_sha256</code> (SHA-256 of typed PIN)</li><li><code>updates.muted_packages</code> (JSON array)</li></ul><h3 id="commands-calls" tabindex="-1">Commands + calls <a class="header-anchor" href="#commands-calls" aria-label="Permalink to &quot;Commands + calls&quot;">​</a></h3><ul><li>Reset password: <ul><li>Reads <code>devices/{deviceId}.ownerEmail</code> and calls <code>sendPasswordResetEmail</code>.</li></ul></li><li>Factory reset: <ul><li>Adds <code>devices/{deviceId}/commands</code> with <code>type=wipe</code>.</li></ul></li><li>Uninstall: <ul><li>Adds <code>devices/{deviceId}/commands</code> with <code>type=uninstall</code>.</li></ul></li><li>Privacy policy opens <code>/privacy</code> in a new tab.</li><li>Language values: <code>en</code> and <code>iw</code>.</li><li>Density values: <code>0</code> (default), <code>20</code>, <code>25</code>, <code>50</code>, <code>75</code>, <code>100</code>.</li><li>PIN input filters to digits and hashes once length &gt;= 4 (no max enforced in UI).</li></ul><h2 id="payments-device-slots" tabindex="-1">Payments (device slots) <a class="header-anchor" href="#payments-device-slots" aria-label="Permalink to &quot;Payments (device slots)&quot;">​</a></h2><ul><li>Header &quot;Add device&quot; calls Cloud Run: <ul><li><code>https://createdeviceslotcheckouthttp-xjmaoa4a5a-uc.a.run.app</code></li><li>Authorization: Firebase ID token in <code>Authorization: Bearer &lt;token&gt;</code>.</li><li>Body: <code>{ quantity: 1 }</code>.</li><li>Redirects to <code>url</code> from the response.</li></ul></li></ul><h2 id="environment-vars" tabindex="-1">Environment vars <a class="header-anchor" href="#environment-vars" aria-label="Permalink to &quot;Environment vars&quot;">​</a></h2><ul><li><code>NEXT_PUBLIC_CF_TURNSTILE_SITEKEY</code> (optional): enables Turnstile on login.</li><li><code>NEXT_PUBLIC_CF_ANALYTICS_TOKEN</code> (optional): enables Cloudflare Insights beacon.</li><li><code>NEXT_PUBLIC_SITE_URL</code> (optional): base URL for robots/sitemap.</li><li><code>VERCEL_URL</code> (fallback): used when <code>NEXT_PUBLIC_SITE_URL</code> is missing.</li></ul><h2 id="theme-global-ui" tabindex="-1">Theme + global UI <a class="header-anchor" href="#theme-global-ui" aria-label="Permalink to &quot;Theme + global UI&quot;">​</a></h2><ul><li>Theme provider: <code>app/providers.tsx</code> (MUI dark theme, Inter font, rounded corners).</li><li>Global CSS: <code>app/globals.css</code> (dark background, border-box).</li></ul><h2 id="error-404" tabindex="-1">Error + 404 <a class="header-anchor" href="#error-404" aria-label="Permalink to &quot;Error + 404&quot;">​</a></h2><ul><li>Global error page: <code>app/error.tsx</code> (Retry + Go home).</li><li>Not found page: <code>app/not-found.tsx</code> (Go home + Reload).</li></ul><h2 id="build-deploy" tabindex="-1">Build + deploy <a class="header-anchor" href="#build-deploy" aria-label="Permalink to &quot;Build + deploy&quot;">​</a></h2><ul><li>Next.js is configured for static export (<code>output: &quot;export&quot;</code> in <code>next.config.mjs</code>).</li><li>Build output is <code>out/</code>.</li><li>Next Image is unoptimized (<code>images.unoptimized=true</code>).</li><li><code>wrangler.jsonc</code> serves <code>./out</code> for Cloudflare Pages/Workers.</li><li>Commands: <ul><li><code>npm run dev</code> (local)</li><li><code>npm run build</code> (static export)</li><li><code>npm run deploy:pages</code> (build + Cloudflare Pages deploy)</li></ul></li></ul><h2 id="firebase-client" tabindex="-1">Firebase client <a class="header-anchor" href="#firebase-client" aria-label="Permalink to &quot;Firebase client&quot;">​</a></h2><ul><li>Config in <code>lib/firebase.ts</code> (hard-coded).</li><li><code>getFunctions(app, &quot;us-central1&quot;)</code>.</li><li>Analytics is client-only and guarded for SSR.</li><li>Debug handle in browser: <code>window.__firebase = { app, db, functions, auth }</code>.</li></ul><h2 id="robots-sitemap" tabindex="-1">Robots + sitemap <a class="header-anchor" href="#robots-sitemap" aria-label="Permalink to &quot;Robots + sitemap&quot;">​</a></h2><ul><li><code>app/robots.ts</code> and <code>app/sitemap.ts</code> use <code>lib/siteMetadata.ts</code>.</li><li>Routes included: <code>/</code> and <code>/login</code>.</li><li><code>sitemap.xml</code> uses <code>changeFrequency: weekly</code> with priority <code>1</code> for <code>/</code> and <code>0.7</code> for <code>/login</code>.</li></ul></div></div></main><footer class="VPDocFooter" data-v-39a288b8 data-v-e257564d><!--[--><!--]--><!----><nav class="prev-next" aria-labelledby="doc-footer-aria-label" data-v-e257564d><span class="visually-hidden" id="doc-footer-aria-label" data-v-e257564d>Pager</span><div class="pager" data-v-e257564d><a class="VPLink link pager-link prev" href="/docs/android-app/" data-v-e257564d><!--[--><span class="desc" data-v-e257564d>Previous page</span><span class="title" data-v-e257564d>Android app</span><!--]--></a></div><div class="pager" data-v-e257564d><a class="VPLink link pager-link next" href="/docs/firestore-config.html" data-v-e257564d><!--[--><span class="desc" data-v-e257564d>Next page</span><span class="title" data-v-e257564d>Firestore config</span><!--]--></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><!----><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"android-app_accessibility_android-auto-quirk.md\":\"SeK5bcqi\",\"android-app_accessibility_block-ai-chats.md\":\"U42nXXon\",\"android-app_accessibility_block-all-in-app-browsers.md\":\"YL1juMSo\",\"android-app_accessibility_block-default-browsers.md\":\"D_RavivG\",\"android-app_accessibility_block-status.md\":\"CmW_K--Z\",\"android-app_accessibility_block-whatsapp-channels.md\":\"KS698Cpe\",\"android-app_accessibility_block-whatsapp-updates-tab.md\":\"CivJtV6y\",\"android-app_accessibility_index.md\":\"CAn8HHjb\",\"android-app_apps_add-webview-exception.md\":\"B9AuDxHf\",\"android-app_apps_block-in-app-browser.md\":\"Cc3hNab_\",\"android-app_apps_block-uninstall.md\":\"8zxVmXZp\",\"android-app_apps_block-video.md\":\"B1W_sF2H\",\"android-app_apps_disable.md\":\"D_nCDahz\",\"android-app_apps_hide.md\":\"BzGKgu9b\",\"android-app_apps_index.md\":\"C7NCaY4b\",\"android-app_apps_make-offline.md\":\"D46VP2mp\",\"android-app_apps_make-suspended.md\":\"OqkvEGUD\",\"android-app_apps_managed-apps.md\":\"BqY5wn8x\",\"android-app_apps_system-apps.md\":\"BjuKGuqG\",\"android-app_apps_users-apps.md\":\"Cipy_--M\",\"android-app_home_app-update-prompt.md\":\"z35IkTO-\",\"android-app_home_did-you-know.md\":\"25SWeVGT\",\"android-app_home_hi.md\":\"bEgVywJp\",\"android-app_home_index.md\":\"ByRsqcaz\",\"android-app_home_managed-apps-overview.md\":\"L3TBwTBA\",\"android-app_home_policies-applied-counter.md\":\"DlXCjLj0\",\"android-app_home_policies-at-a-glance.md\":\"BZc3PsEU\",\"android-app_home_whitelist-summary-card.md\":\"BDlTus6r\",\"android-app_index.md\":\"CM8aQnsx\",\"android-app_installation_allow-user-updates.md\":\"C_Lm-Fpr\",\"android-app_installation_block-new-apps.md\":\"hxPdyQcT\",\"android-app_installation_block-play-store.md\":\"BsDeMLGC\",\"android-app_installation_disable-apk-install.md\":\"DwHyjsly\",\"android-app_installation_index.md\":\"DDgvpR6t\",\"android-app_invisible-features_accessibility-helpers.md\":\"CyYfJEWg\",\"android-app_invisible-features_app-state-sync.md\":\"B5h5Ak9W\",\"android-app_invisible-features_config-sync.md\":\"CZBbNP5r\",\"android-app_invisible-features_identity-admin.md\":\"Cf4I2s5R\",\"android-app_invisible-features_index.md\":\"Dgdw7cqW\",\"android-app_invisible-features_lifecycle-session.md\":\"CIOEEiw7\",\"android-app_invisible-features_network-vpn-internals.md\":\"8jPpVLyS\",\"android-app_invisible-features_remote-control-reporting.md\":\"thtZ4mR6\",\"android-app_invisible-features_security-integrity.md\":\"CPO1dAxi\",\"android-app_invisible-features_updates-notifications.md\":\"BZUoCDzA\",\"android-app_network_block-all-traffic.md\":\"U4QtnBYS\",\"android-app_network_block-wi-fi.md\":\"BtiQpQ5G\",\"android-app_network_disable-tethering-and-hotspot.md\":\"CwVB_lCQ\",\"android-app_network_enable-private-dns.md\":\"zo-WCClI\",\"android-app_network_enable-vpn-firewall-regular-vpn-not-vpn2.md\":\"CQiY_VoS\",\"android-app_network_index.md\":\"mVp8qhrE\",\"android-app_network_whitelist-domains-regular-vpn-not-vpn2.md\":\"DofVR53T\",\"android-app_onboarding_device-binding.md\":\"CTQA60FN\",\"android-app_onboarding_index.md\":\"jIkUWIII\",\"android-app_onboarding_mdm-pin-gate.md\":\"B-IAe9D6\",\"android-app_onboarding_onboarding-overview.md\":\"CCVuMXnk\",\"android-app_onboarding_password-reset.md\":\"AaF503hw\",\"android-app_onboarding_permissions-check.md\":\"BKMH23Mi\",\"android-app_onboarding_pin-recovery.md\":\"DYsz54uV\",\"android-app_onboarding_sign-in.md\":\"D2H-59z4\",\"android-app_onboarding_sign-up.md\":\"k4yiEoGz\",\"android-app_onboarding_verify-email.md\":\"BYkWuxro\",\"android-app_onboarding_welcome-terms.md\":\"BJTfsrcC\",\"android-app_settings_account-info.md\":\"Bst34ZFT\",\"android-app_settings_app-density.md\":\"C1gYGgWX\",\"android-app_settings_check-for-app-updates.md\":\"B_iSYaOb\",\"android-app_settings_delete-my-account.md\":\"DfeUUkMQ\",\"android-app_settings_export-profile.md\":\"DYC0U2oz\",\"android-app_settings_import-profile.md\":\"DILbrub9\",\"android-app_settings_import-whitelist.md\":\"DgH-fu0_\",\"android-app_settings_index.md\":\"X_89NHrt\",\"android-app_settings_muted-updates.md\":\"CklRkxMF\",\"android-app_settings_privacy-policy.md\":\"C5IGRwIi\",\"android-app_settings_reset-mdm-pin.md\":\"tlFn_aL3\",\"android-app_settings_support-us.md\":\"ner4hJMy\",\"android-app_settings_switch-to-hebrew.md\":\"DBz-RsTa\",\"android-app_settings_uninstall.md\":\"S9pjrqo0\",\"android-app_system_block-developer-options.md\":\"CWsTA6Gm\",\"android-app_system_block-phone-calls.md\":\"BnrvPKwN\",\"android-app_system_disable-app-settings-control.md\":\"DQ2AaKj2\",\"android-app_system_disable-factory-reset.md\":\"IrbP003D\",\"android-app_system_disable-sms-mms.md\":\"BaiJIEwv\",\"android-app_system_disallow-adding-users.md\":\"mmglRJG5\",\"android-app_system_index.md\":\"C36KpQdN\",\"android-app_updates_aurora-updater.md\":\"CEf3OkKq\",\"android-app_updates_index.md\":\"XqKAX7Ls\",\"directus.md\":\"C2RwsJFh\",\"firestore-config.md\":\"CIbSw3PD\",\"index.md\":\"C02Lv-bH\",\"vpn-wireguard.md\":\"BcYlUgyT\",\"website.md\":\"BVA5BdvV\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"TripleUMDM Docs\",\"description\":\"Internal system docs\",\"base\":\"/docs/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"nav\":[{\"text\":\"Home\",\"link\":\"/\"},{\"text\":\"Android MDM app\",\"link\":\"/android-app/\"},{\"text\":\"Website TS\",\"link\":\"/website\"},{\"text\":\"Firestore config DB\",\"link\":\"/firestore-config\"},{\"text\":\"VPN + MITM proxy\",\"link\":\"/vpn-wireguard\"},{\"text\":\"Directus DB\",\"link\":\"/directus\"}],\"sidebar\":{\"/android-app/\":[{\"text\":\"Overview\",\"link\":\"/android-app/\"},{\"text\":\"Onboarding\",\"items\":[{\"text\":\"Overview\",\"link\":\"/android-app/onboarding/\"},{\"text\":\"Onboarding overview\",\"link\":\"/android-app/onboarding/onboarding-overview\"},{\"text\":\"Welcome + terms\",\"link\":\"/android-app/onboarding/welcome-terms\"},{\"text\":\"Sign in\",\"link\":\"/android-app/onboarding/sign-in\"},{\"text\":\"Sign up\",\"link\":\"/android-app/onboarding/sign-up\"},{\"text\":\"Verify email\",\"link\":\"/android-app/onboarding/verify-email\"},{\"text\":\"Password reset\",\"link\":\"/android-app/onboarding/password-reset\"},{\"text\":\"Device binding\",\"link\":\"/android-app/onboarding/device-binding\"},{\"text\":\"MDM PIN gate\",\"link\":\"/android-app/onboarding/mdm-pin-gate\"},{\"text\":\"PIN recovery\",\"link\":\"/android-app/onboarding/pin-recovery\"},{\"text\":\"Permissions check\",\"link\":\"/android-app/onboarding/permissions-check\"}]},{\"text\":\"Home tab\",\"items\":[{\"text\":\"Overview\",\"link\":\"/android-app/home/\"},{\"text\":\"Hi\",\"link\":\"/android-app/home/hi\"},{\"text\":\"Policies at a glance\",\"link\":\"/android-app/home/policies-at-a-glance\"},{\"text\":\"Did you know\",\"link\":\"/android-app/home/did-you-know\"},{\"text\":\"Policies applied counter\",\"link\":\"/android-app/home/policies-applied-counter\"},{\"text\":\"Managed apps overview\",\"link\":\"/android-app/home/managed-apps-overview\"},{\"text\":\"Whitelist summary card\",\"link\":\"/android-app/home/whitelist-summary-card\"},{\"text\":\"App update prompt\",\"link\":\"/android-app/home/app-update-prompt\"}]},{\"text\":\"System tab\",\"items\":[{\"text\":\"Overview\",\"link\":\"/android-app/system/\"},{\"text\":\"Disallow adding users\",\"link\":\"/android-app/system/disallow-adding-users\"},{\"text\":\"Disable factory reset\",\"link\":\"/android-app/system/disable-factory-reset\"},{\"text\":\"Block developer options\",\"link\":\"/android-app/system/block-developer-options\"},{\"text\":\"Disable app settings control\",\"link\":\"/android-app/system/disable-app-settings-control\"},{\"text\":\"Block phone calls\",\"link\":\"/android-app/system/block-phone-calls\"},{\"text\":\"Disable SMS/MMS\",\"link\":\"/android-app/system/disable-sms-mms\"}]},{\"text\":\"Installation\",\"items\":[{\"text\":\"Overview\",\"link\":\"/android-app/installation/\"},{\"text\":\"Disable APK install\",\"link\":\"/android-app/installation/disable-apk-install\"},{\"text\":\"Block new apps\",\"link\":\"/android-app/installation/block-new-apps\"},{\"text\":\"Allow user updates\",\"link\":\"/android-app/installation/allow-user-updates\"},{\"text\":\"Block Play Store\",\"link\":\"/android-app/installation/block-play-store\"}]},{\"text\":\"Accessibility\",\"items\":[{\"text\":\"Overview\",\"link\":\"/android-app/accessibility/\"},{\"text\":\"Android Auto quirk\",\"link\":\"/android-app/accessibility/android-auto-quirk\"},{\"text\":\"Block WhatsApp updates tab\",\"link\":\"/android-app/accessibility/block-whatsapp-updates-tab\"},{\"text\":\"Block WhatsApp channels\",\"link\":\"/android-app/accessibility/block-whatsapp-channels\"},{\"text\":\"Block status\",\"link\":\"/android-app/accessibility/block-status\"},{\"text\":\"Block AI chats\",\"link\":\"/android-app/accessibility/block-ai-chats\"},{\"text\":\"Block all in-app browsers\",\"link\":\"/android-app/accessibility/block-all-in-app-browsers\"},{\"text\":\"Block default browsers\",\"link\":\"/android-app/accessibility/block-default-browsers\"}]},{\"text\":\"Network tab\",\"items\":[{\"text\":\"Overview\",\"link\":\"/android-app/network/\"},{\"text\":\"Disable tethering and hotspot\",\"link\":\"/android-app/network/disable-tethering-and-hotspot\"},{\"text\":\"Block Wi-Fi\",\"link\":\"/android-app/network/block-wi-fi\"},{\"text\":\"Block all traffic\",\"link\":\"/android-app/network/block-all-traffic\"},{\"text\":\"Enable private DNS\",\"link\":\"/android-app/network/enable-private-dns\"},{\"text\":\"Enable VPN firewall (regular VPN, not VPN2)\",\"link\":\"/android-app/network/enable-vpn-firewall-regular-vpn-not-vpn2\"},{\"text\":\"Whitelist domains (regular VPN, not VPN2)\",\"link\":\"/android-app/network/whitelist-domains-regular-vpn-not-vpn2\"}]},{\"text\":\"Updates tab\",\"items\":[{\"text\":\"Overview\",\"link\":\"/android-app/updates/\"},{\"text\":\"Aurora updater\",\"link\":\"/android-app/updates/aurora-updater\"}]},{\"text\":\"Apps tab\",\"items\":[{\"text\":\"Overview\",\"link\":\"/android-app/apps/\"},{\"text\":\"Users apps\",\"link\":\"/android-app/apps/users-apps\"},{\"text\":\"System apps\",\"link\":\"/android-app/apps/system-apps\"},{\"text\":\"Managed apps\",\"link\":\"/android-app/apps/managed-apps\"},{\"text\":\"Hide\",\"link\":\"/android-app/apps/hide\"},{\"text\":\"Make offline\",\"link\":\"/android-app/apps/make-offline\"},{\"text\":\"Make suspended\",\"link\":\"/android-app/apps/make-suspended\"},{\"text\":\"Disable\",\"link\":\"/android-app/apps/disable\"},{\"text\":\"Block video\",\"link\":\"/android-app/apps/block-video\"},{\"text\":\"Block in-app browser\",\"link\":\"/android-app/apps/block-in-app-browser\"},{\"text\":\"Block uninstall\",\"link\":\"/android-app/apps/block-uninstall\"},{\"text\":\"Add WebView exception\",\"link\":\"/android-app/apps/add-webview-exception\"}]},{\"text\":\"Settings tab\",\"items\":[{\"text\":\"Overview\",\"link\":\"/android-app/settings/\"},{\"text\":\"Switch to Hebrew\",\"link\":\"/android-app/settings/switch-to-hebrew\"},{\"text\":\"Export profile\",\"link\":\"/android-app/settings/export-profile\"},{\"text\":\"Import profile\",\"link\":\"/android-app/settings/import-profile\"},{\"text\":\"Import whitelist\",\"link\":\"/android-app/settings/import-whitelist\"},{\"text\":\"Account info\",\"link\":\"/android-app/settings/account-info\"},{\"text\":\"Privacy policy\",\"link\":\"/android-app/settings/privacy-policy\"},{\"text\":\"Check for app updates\",\"link\":\"/android-app/settings/check-for-app-updates\"},{\"text\":\"Support us\",\"link\":\"/android-app/settings/support-us\"},{\"text\":\"App density\",\"link\":\"/android-app/settings/app-density\"},{\"text\":\"Muted updates\",\"link\":\"/android-app/settings/muted-updates\"},{\"text\":\"Reset MDM PIN\",\"link\":\"/android-app/settings/reset-mdm-pin\"},{\"text\":\"Uninstall\",\"link\":\"/android-app/settings/uninstall\"},{\"text\":\"Delete my account\",\"link\":\"/android-app/settings/delete-my-account\"}]},{\"text\":\"Invisible features\",\"items\":[{\"text\":\"Overview\",\"link\":\"/android-app/invisible-features/\"},{\"text\":\"Lifecycle + session\",\"link\":\"/android-app/invisible-features/lifecycle-session\"},{\"text\":\"Identity + admin\",\"link\":\"/android-app/invisible-features/identity-admin\"},{\"text\":\"Config + sync\",\"link\":\"/android-app/invisible-features/config-sync\"},{\"text\":\"App state sync\",\"link\":\"/android-app/invisible-features/app-state-sync\"},{\"text\":\"Network + VPN internals\",\"link\":\"/android-app/invisible-features/network-vpn-internals\"},{\"text\":\"Accessibility helpers\",\"link\":\"/android-app/invisible-features/accessibility-helpers\"},{\"text\":\"Remote control + reporting\",\"link\":\"/android-app/invisible-features/remote-control-reporting\"},{\"text\":\"Updates + notifications\",\"link\":\"/android-app/invisible-features/updates-notifications\"},{\"text\":\"Security + integrity\",\"link\":\"/android-app/invisible-features/security-integrity\"}]}],\"/\":[{\"text\":\"Home\",\"link\":\"/\"},{\"text\":\"Android app\",\"link\":\"/android-app/\"},{\"text\":\"Website\",\"link\":\"/website\"},{\"text\":\"Firestore config\",\"link\":\"/firestore-config\"},{\"text\":\"VPN + MITM proxy\",\"link\":\"/vpn-wireguard\"},{\"text\":\"Directus\",\"link\":\"/directus\"}]}},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false}");</script>
    
  </body>
</html>